# VisAPI Environment Configuration Guide

This document provides a comprehensive overview of all environment variables used in the VisAPI project.

## üìÅ Environment File Structure

```
VisAPI/
‚îú‚îÄ‚îÄ .env.frontend          # Production values for Vercel (frontend)
‚îú‚îÄ‚îÄ .env.frontend.example  # Template for frontend environment
‚îú‚îÄ‚îÄ .env.backend           # Production values for Render (backend)
‚îú‚îÄ‚îÄ .env.backend.example   # Template for backend environment
‚îú‚îÄ‚îÄ .env.local             # Local development (all variables)
‚îú‚îÄ‚îÄ .env.example           # Local development template
‚îî‚îÄ‚îÄ .env.README.md         # This file - master documentation
```

## üöÄ Quick Start

### For Local Development:
1. Copy `.env.example` to `.env.local`
2. Fill in your values
3. Run `pnpm dev`

### For Frontend Deployment (Vercel):
1. Copy values from `.env.frontend`
2. Add to Vercel dashboard: https://vercel.com/your-team/visapi/settings/environment-variables

### For Backend Deployment (Render):
1. Copy values from `.env.backend`
2. Add to Render dashboard: https://dashboard.render.com/web/srv-d1qn5sre5dus73f531o0/env

## üìä Complete Variable Reference

### üé® Frontend Variables (Vercel)
**File:** [.env.frontend](./.env.frontend)

| Variable | Description | Example |
|----------|-------------|---------|
| `NEXT_PUBLIC_API_URL` | Backend API endpoint | `https://api.visanet.app` |
| `NEXT_PUBLIC_ENV` | Environment mode | `production` |
| `NEXT_PUBLIC_SUPABASE_URL` | Supabase project URL | `https://[ref].supabase.co` |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Public anon key (safe for frontend) | `eyJ...` |

### üîß Backend Variables (Render)
**File:** [.env.backend](./.env.backend)

#### Core Configuration
| Variable | Description | Required |
|----------|-------------|----------|
| `NODE_ENV` | Node environment | ‚úÖ |
| `PORT` | Server port | ‚úÖ |
| `DATABASE_URL` | PostgreSQL connection string | ‚úÖ |
| `REDIS_URL` | Redis connection (Upstash) | ‚úÖ |

#### Supabase Configuration
| Variable | Description | Required |
|----------|-------------|----------|
| `SUPABASE_URL` | Supabase project URL | ‚úÖ |
| `SUPABASE_ANON_KEY` | Public anon key | ‚úÖ |
| `SUPABASE_SERVICE_ROLE_KEY` | Service role key (keep secret!) | ‚úÖ |
| `SUPABASE_STORAGE_BUCKET` | Storage bucket name | ‚úÖ |

#### Security
| Variable | Description | Required |
|----------|-------------|----------|
| `JWT_SECRET` | JWT signing secret | ‚úÖ |
| `SESSION_SECRET` | Session encryption key | ‚úÖ |
| `CRON_SECRET` | Cron job authentication | ‚úÖ |
| `CORS_ORIGIN` | Allowed origins | ‚úÖ |
| `API_KEY_PREFIX` | API key prefix | ‚úÖ |
| `API_KEY_EXPIRY_DAYS` | API key expiration | ‚úÖ |
| `ALLOWED_EMAIL_DOMAINS` | Email domain allowlist | ‚úÖ |

#### Rate Limiting
| Variable | Description | Default |
|----------|-------------|---------|
| `API_RATE_LIMIT_BURST` | Max burst requests | 200 |
| `API_RATE_LIMIT_SUSTAINED` | Sustained req/sec | 2 |

#### Queue Configuration
| Variable | Description | Default |
|----------|-------------|---------|
| `QUEUE_CONCURRENCY` | Worker concurrency | 10 |
| `QUEUE_MAX_RETRIES` | Max retry attempts | 3 |
| `QUEUE_RETRY_DELAY` | Retry delay (ms) | 5000 |

#### Integrations
| Variable | Description | Required |
|----------|-------------|----------|
| `CGB_API_URL` | WhatsApp API endpoint | ‚úÖ |
| `CGB_API_KEY` | WhatsApp API key | ‚úÖ |
| `RESEND_API_KEY` | Email service API key | ‚úÖ |
| `NOREPLY_EMAIL` | Email sender address | ‚úÖ |
| `PUPPETEER_SKIP_CHROMIUM_DOWNLOAD` | Skip Chrome download | ‚úÖ |

## üîê Security Best Practices

1. **Never commit** actual environment files (only `.example` files)
2. **Rotate secrets** regularly (especially JWT_SECRET, API keys)
3. **Use strong passwords** - minimum 32 characters for secrets
4. **Limit access** - use Vercel/Render team permissions
5. **Audit regularly** - check for exposed secrets

## üõ†Ô∏è Getting Credentials

### Supabase
1. Go to: https://supabase.com/dashboard/project/YOUR_PROJECT/settings/api
2. Copy: Project URL, anon key, and service role key

### Upstash Redis
1. Go to: https://console.upstash.com/
2. Create a Redis database
3. Copy the Redis URL (with password)

### Resend (Email)
1. Go to: https://resend.com/api-keys
2. Create an API key
3. Verify your domain

### ChatGPT Builder (WhatsApp)
1. Go to: https://app.chatgptbuilder.io/dashboard
2. Get your API key
3. Configure your WhatsApp flows

## üìù Environment Variable Types

- **Public** (`NEXT_PUBLIC_*`): Safe for frontend, visible in browser
- **Private**: Backend only, never exposed to client
- **Secret**: Sensitive credentials, rotate regularly
- **Optional**: Has defaults in code, not required

## üö® Troubleshooting

### Common Issues:

1. **"Invalid REDIS_URL"**
   - Check the URL is complete: `rediss://default:password@host:port`
   - Ensure no truncation when copying

2. **"CORS errors"**
   - Verify `CORS_ORIGIN` matches your frontend URL exactly
   - Include protocol: `https://app.visanet.app`

3. **"Database connection failed"**
   - Check `DATABASE_URL` format and credentials
   - Verify Supabase project is active

4. **"Missing environment variable"**
   - Check logs for specific variable name
   - Ensure all required variables are set

## üìû Support

For environment configuration help:
1. Check this documentation first
2. Review example files
3. Check deployment platform docs (Vercel/Render)
4. Contact team lead for sensitive credentials

---

Last Updated: July 16, 2025