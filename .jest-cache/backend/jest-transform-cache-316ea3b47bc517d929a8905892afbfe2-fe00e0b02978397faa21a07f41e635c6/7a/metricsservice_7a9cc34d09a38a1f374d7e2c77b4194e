03569da61d5a526b8144791ff5a27738
"use strict";
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", { value: true });
exports.MetricsService = void 0;
const tslib_1 = require("tslib");
const common_1 = require("@nestjs/common");
const nestjs_prometheus_1 = require("@willsoto/nestjs-prometheus");
const prom_client_1 = require("prom-client");
let MetricsService = class MetricsService {
    constructor(httpRequestDuration, httpRequestsTotal, httpActiveConnections, jobLatencySeconds, jobFailTotal, queueDepthTotal, webhookProcessedTotal, workflowExecutionDuration, apiKeyValidationDuration, redisOperationsTotal, redisOperationErrorsTotal) {
        this.httpRequestDuration = httpRequestDuration;
        this.httpRequestsTotal = httpRequestsTotal;
        this.httpActiveConnections = httpActiveConnections;
        this.jobLatencySeconds = jobLatencySeconds;
        this.jobFailTotal = jobFailTotal;
        this.queueDepthTotal = queueDepthTotal;
        this.webhookProcessedTotal = webhookProcessedTotal;
        this.workflowExecutionDuration = workflowExecutionDuration;
        this.apiKeyValidationDuration = apiKeyValidationDuration;
        this.redisOperationsTotal = redisOperationsTotal;
        this.redisOperationErrorsTotal = redisOperationErrorsTotal;
    }
    recordHttpRequest(method, route, statusCode, duration) {
        const labels = { method, route, status_code: statusCode.toString() };
        this.httpRequestDuration.observe(labels, duration / 1000); // Convert to seconds
        this.httpRequestsTotal.inc(labels);
    }
    incrementActiveConnections() {
        this.httpActiveConnections.inc();
    }
    decrementActiveConnections() {
        this.httpActiveConnections.dec();
    }
    recordJobExecution(jobName, queue, success, duration) {
        const labels = { job_name: jobName, queue, success: success.toString() };
        this.jobLatencySeconds.observe(labels, duration / 1000);
        if (!success) {
            this.jobFailTotal.inc({ job_name: jobName, queue });
        }
    }
    setQueueDepth(queue, priority, depth) {
        this.queueDepthTotal.set({ queue, priority }, depth);
    }
    incrementWebhookProcessed(status) {
        this.webhookProcessedTotal.inc({ status });
    }
    recordWorkflowExecution(workflowId, duration, success) {
        this.workflowExecutionDuration.observe({ workflow_id: workflowId, success: success.toString() }, duration / 1000);
    }
    recordApiKeyValidation(duration, valid) {
        this.apiKeyValidationDuration.observe({ valid: valid.toString() }, duration / 1000);
    }
    recordRedisOperation(operation, success) {
        this.redisOperationsTotal.inc({ operation, success: success.toString() });
        if (!success) {
            this.redisOperationErrorsTotal.inc({ operation });
        }
    }
};
exports.MetricsService = MetricsService;
exports.MetricsService = MetricsService = tslib_1.__decorate([
    (0, common_1.Injectable)(),
    tslib_1.__param(0, (0, nestjs_prometheus_1.InjectMetric)('http_request_duration_seconds')),
    tslib_1.__param(1, (0, nestjs_prometheus_1.InjectMetric)('http_requests_total')),
    tslib_1.__param(2, (0, nestjs_prometheus_1.InjectMetric)('http_active_connections')),
    tslib_1.__param(3, (0, nestjs_prometheus_1.InjectMetric)('job_latency_seconds')),
    tslib_1.__param(4, (0, nestjs_prometheus_1.InjectMetric)('job_fail_total')),
    tslib_1.__param(5, (0, nestjs_prometheus_1.InjectMetric)('queue_depth_total')),
    tslib_1.__param(6, (0, nestjs_prometheus_1.InjectMetric)('webhook_processed_total')),
    tslib_1.__param(7, (0, nestjs_prometheus_1.InjectMetric)('workflow_execution_duration_seconds')),
    tslib_1.__param(8, (0, nestjs_prometheus_1.InjectMetric)('api_key_validation_duration_seconds')),
    tslib_1.__param(9, (0, nestjs_prometheus_1.InjectMetric)('redis_operations_total')),
    tslib_1.__param(10, (0, nestjs_prometheus_1.InjectMetric)('redis_operation_errors_total')),
    tslib_1.__metadata("design:paramtypes", [typeof (_a = typeof prom_client_1.Histogram !== "undefined" && prom_client_1.Histogram) === "function" ? _a : Object, typeof (_b = typeof prom_client_1.Counter !== "undefined" && prom_client_1.Counter) === "function" ? _b : Object, typeof (_c = typeof prom_client_1.Gauge !== "undefined" && prom_client_1.Gauge) === "function" ? _c : Object, typeof (_d = typeof prom_client_1.Histogram !== "undefined" && prom_client_1.Histogram) === "function" ? _d : Object, typeof (_e = typeof prom_client_1.Counter !== "undefined" && prom_client_1.Counter) === "function" ? _e : Object, typeof (_f = typeof prom_client_1.Gauge !== "undefined" && prom_client_1.Gauge) === "function" ? _f : Object, typeof (_g = typeof prom_client_1.Counter !== "undefined" && prom_client_1.Counter) === "function" ? _g : Object, typeof (_h = typeof prom_client_1.Histogram !== "undefined" && prom_client_1.Histogram) === "function" ? _h : Object, typeof (_j = typeof prom_client_1.Histogram !== "undefined" && prom_client_1.Histogram) === "function" ? _j : Object, typeof (_k = typeof prom_client_1.Counter !== "undefined" && prom_client_1.Counter) === "function" ? _k : Object, typeof (_l = typeof prom_client_1.Counter !== "undefined" && prom_client_1.Counter) === "function" ? _l : Object])
], MetricsService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3ZhZGltL1Byb2plY3RzL1Zpc0FQSS9hcHBzL2JhY2tlbmQvc3JjL21ldHJpY3MvbWV0cmljcy5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsMkNBQTRDO0FBQzVDLG1FQUEyRDtBQUMzRCw2Q0FBd0Q7QUFHakQsSUFBTSxjQUFjLEdBQXBCLE1BQU0sY0FBYztJQUN6QixZQUVTLG1CQUFzQyxFQUd0QyxpQkFBa0MsRUFHbEMscUJBQW9DLEVBR3BDLGlCQUFvQyxFQUdwQyxZQUE2QixFQUc3QixlQUE4QixFQUc5QixxQkFBc0MsRUFHdEMseUJBQTRDLEVBRzVDLHdCQUEyQyxFQUczQyxvQkFBcUMsRUFHckMseUJBQTBDO1FBOUIxQyx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQW1CO1FBR3RDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBaUI7UUFHbEMsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUFlO1FBR3BDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFHcEMsaUJBQVksR0FBWixZQUFZLENBQWlCO1FBRzdCLG9CQUFlLEdBQWYsZUFBZSxDQUFlO1FBRzlCLDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBaUI7UUFHdEMsOEJBQXlCLEdBQXpCLHlCQUF5QixDQUFtQjtRQUc1Qyw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQW1CO1FBRzNDLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBaUI7UUFHckMsOEJBQXlCLEdBQXpCLHlCQUF5QixDQUFpQjtJQUNoRCxDQUFDO0lBRUosaUJBQWlCLENBQ2YsTUFBYyxFQUNkLEtBQWEsRUFDYixVQUFrQixFQUNsQixRQUFnQjtRQUVoQixNQUFNLE1BQU0sR0FBRyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLFVBQVUsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDO1FBRXJFLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLFFBQVEsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLHFCQUFxQjtRQUNo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Q0FBWSxFQUFDLHFDQUFxQyxDQUFDLENBQUE7SUFHbkQsbUJBQUEsSUFBQSxnQ0FBWSxFQUFDLHdCQUF3QixDQUFDLENBQUE7SUFHdEMsb0JBQUEsSUFBQSxnQ0FBWSxFQUFDLDhCQUE4QixDQUFDLENBQUE7aUVBN0JqQix1QkFBUyxvQkFBVCx1QkFBUyxvREFHWCxxQkFBTyxvQkFBUCxxQkFBTyxvREFHSCxtQkFBSyxvQkFBTCxtQkFBSyxvREFHVCx1QkFBUyxvQkFBVCx1QkFBUyxvREFHZCxxQkFBTyxvQkFBUCxxQkFBTyxvREFHSixtQkFBSyxvQkFBTCxtQkFBSyxvREFHQyxxQkFBTyxvQkFBUCxxQkFBTyxvREFHSCx1QkFBUyxvQkFBVCx1QkFBUyxvREFHVix1QkFBUyxvQkFBVCx1QkFBUyxvREFHYixxQkFBTyxvQkFBUCxxQkFBTyxvREFHRixxQkFBTyxvQkFBUCxxQkFBTztHQWpDaEMsY0FBYyxDQXdHMUIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3ZhZGltL1Byb2plY3RzL1Zpc0FQSS9hcHBzL2JhY2tlbmQvc3JjL21ldHJpY3MvbWV0cmljcy5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBJbmplY3RNZXRyaWMgfSBmcm9tICdAd2lsbHNvdG8vbmVzdGpzLXByb21ldGhldXMnO1xuaW1wb3J0IHsgQ291bnRlciwgSGlzdG9ncmFtLCBHYXVnZSB9IGZyb20gJ3Byb20tY2xpZW50JztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE1ldHJpY3NTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdE1ldHJpYygnaHR0cF9yZXF1ZXN0X2R1cmF0aW9uX3NlY29uZHMnKVxuICAgIHB1YmxpYyBodHRwUmVxdWVzdER1cmF0aW9uOiBIaXN0b2dyYW08c3RyaW5nPixcblxuICAgIEBJbmplY3RNZXRyaWMoJ2h0dHBfcmVxdWVzdHNfdG90YWwnKVxuICAgIHB1YmxpYyBodHRwUmVxdWVzdHNUb3RhbDogQ291bnRlcjxzdHJpbmc+LFxuXG4gICAgQEluamVjdE1ldHJpYygnaHR0cF9hY3RpdmVfY29ubmVjdGlvbnMnKVxuICAgIHB1YmxpYyBodHRwQWN0aXZlQ29ubmVjdGlvbnM6IEdhdWdlPHN0cmluZz4sXG5cbiAgICBASW5qZWN0TWV0cmljKCdqb2JfbGF0ZW5jeV9zZWNvbmRzJylcbiAgICBwdWJsaWMgam9iTGF0ZW5jeVNlY29uZHM6IEhpc3RvZ3JhbTxzdHJpbmc+LFxuXG4gICAgQEluamVjdE1ldHJpYygnam9iX2ZhaWxfdG90YWwnKVxuICAgIHB1YmxpYyBqb2JGYWlsVG90YWw6IENvdW50ZXI8c3RyaW5nPixcblxuICAgIEBJbmplY3RNZXRyaWMoJ3F1ZXVlX2RlcHRoX3RvdGFsJylcbiAgICBwdWJsaWMgcXVldWVEZXB0aFRvdGFsOiBHYXVnZTxzdHJpbmc+LFxuXG4gICAgQEluamVjdE1ldHJpYygnd2ViaG9va19wcm9jZXNzZWRfdG90YWwnKVxuICAgIHB1YmxpYyB3ZWJob29rUHJvY2Vzc2VkVG90YWw6IENvdW50ZXI8c3RyaW5nPixcblxuICAgIEBJbmplY3RNZXRyaWMoJ3dvcmtmbG93X2V4ZWN1dGlvbl9kdXJhdGlvbl9zZWNvbmRzJylcbiAgICBwdWJsaWMgd29ya2Zsb3dFeGVjdXRpb25EdXJhdGlvbjogSGlzdG9ncmFtPHN0cmluZz4sXG5cbiAgICBASW5qZWN0TWV0cmljKCdhcGlfa2V5X3ZhbGlkYXRpb25fZHVyYXRpb25fc2Vjb25kcycpXG4gICAgcHVibGljIGFwaUtleVZhbGlkYXRpb25EdXJhdGlvbjogSGlzdG9ncmFtPHN0cmluZz4sXG5cbiAgICBASW5qZWN0TWV0cmljKCdyZWRpc19vcGVyYXRpb25zX3RvdGFsJylcbiAgICBwdWJsaWMgcmVkaXNPcGVyYXRpb25zVG90YWw6IENvdW50ZXI8c3RyaW5nPixcblxuICAgIEBJbmplY3RNZXRyaWMoJ3JlZGlzX29wZXJhdGlvbl9lcnJvcnNfdG90YWwnKVxuICAgIHB1YmxpYyByZWRpc09wZXJhdGlvbkVycm9yc1RvdGFsOiBDb3VudGVyPHN0cmluZz5cbiAgKSB7fVxuXG4gIHJlY29yZEh0dHBSZXF1ZXN0KFxuICAgIG1ldGhvZDogc3RyaW5nLFxuICAgIHJvdXRlOiBzdHJpbmcsXG4gICAgc3RhdHVzQ29kZTogbnVtYmVyLFxuICAgIGR1cmF0aW9uOiBudW1iZXJcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgbGFiZWxzID0geyBtZXRob2QsIHJvdXRlLCBzdGF0dXNfY29kZTogc3RhdHVzQ29kZS50b1N0cmluZygpIH07XG5cbiAgICB0aGlzLmh0dHBSZXF1ZXN0RHVyYXRpb24ub2JzZXJ2ZShsYWJlbHMsIGR1cmF0aW9uIC8gMTAwMCk7IC8vIENvbnZlcnQgdG8gc2Vjb25kc1xuICAgIHRoaXMuaHR0cFJlcXVlc3RzVG90YWwuaW5jKGxhYmVscyk7XG4gIH1cblxuICBpbmNyZW1lbnRBY3RpdmVDb25uZWN0aW9ucygpOiB2b2lkIHtcbiAgICB0aGlzLmh0dHBBY3RpdmVDb25uZWN0aW9ucy5pbmMoKTtcbiAgfVxuXG4gIGRlY3JlbWVudEFjdGl2ZUNvbm5lY3Rpb25zKCk6IHZvaWQge1xuICAgIHRoaXMuaHR0cEFjdGl2ZUNvbm5lY3Rpb25zLmRlYygpO1xuICB9XG5cbiAgcmVjb3JkSm9iRXhlY3V0aW9uKFxuICAgIGpvYk5hbWU6IHN0cmluZyxcbiAgICBxdWV1ZTogc3RyaW5nLFxuICAgIHN1Y2Nlc3M6IGJvb2xlYW4sXG4gICAgZHVyYXRpb246IG51bWJlclxuICApOiB2b2lkIHtcbiAgICBjb25zdCBsYWJlbHMgPSB7IGpvYl9uYW1lOiBqb2JOYW1lLCBxdWV1ZSwgc3VjY2Vzczogc3VjY2Vzcy50b1N0cmluZygpIH07XG5cbiAgICB0aGlzLmpvYkxhdGVuY3lTZWNvbmRzLm9ic2VydmUobGFiZWxzLCBkdXJhdGlvbiAvIDEwMDApO1xuXG4gICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICB0aGlzLmpvYkZhaWxUb3RhbC5pbmMoeyBqb2JfbmFtZTogam9iTmFtZSwgcXVldWUgfSk7XG4gICAgfVxuICB9XG5cbiAgc2V0UXVldWVEZXB0aChxdWV1ZTogc3RyaW5nLCBwcmlvcml0eTogc3RyaW5nLCBkZXB0aDogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5xdWV1ZURlcHRoVG90YWwuc2V0KHsgcXVldWUsIHByaW9yaXR5IH0sIGRlcHRoKTtcbiAgfVxuXG4gIGluY3JlbWVudFdlYmhvb2tQcm9jZXNzZWQoc3RhdHVzOiAnc3VjY2VzcycgfCAnZmFpbHVyZScpOiB2b2lkIHtcbiAgICB0aGlzLndlYmhvb2tQcm9jZXNzZWRUb3RhbC5pbmMoeyBzdGF0dXMgfSk7XG4gIH1cblxuICByZWNvcmRXb3JrZmxvd0V4ZWN1dGlvbihcbiAgICB3b3JrZmxvd0lkOiBzdHJpbmcsXG4gICAgZHVyYXRpb246IG51bWJlcixcbiAgICBzdWNjZXNzOiBib29sZWFuXG4gICk6IHZvaWQge1xuICAgIHRoaXMud29ya2Zsb3dFeGVjdXRpb25EdXJhdGlvbi5vYnNlcnZlKFxuICAgICAgeyB3b3JrZmxvd19pZDogd29ya2Zsb3dJZCwgc3VjY2Vzczogc3VjY2Vzcy50b1N0cmluZygpIH0sXG4gICAgICBkdXJhdGlvbiAvIDEwMDBcbiAgICApO1xuICB9XG5cbiAgcmVjb3JkQXBpS2V5VmFsaWRhdGlvbihkdXJhdGlvbjogbnVtYmVyLCB2YWxpZDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuYXBpS2V5VmFsaWRhdGlvbkR1cmF0aW9uLm9ic2VydmUoXG4gICAgICB7IHZhbGlkOiB2YWxpZC50b1N0cmluZygpIH0sXG4gICAgICBkdXJhdGlvbiAvIDEwMDBcbiAgICApO1xuICB9XG5cbiAgcmVjb3JkUmVkaXNPcGVyYXRpb24ob3BlcmF0aW9uOiBzdHJpbmcsIHN1Y2Nlc3M6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLnJlZGlzT3BlcmF0aW9uc1RvdGFsLmluYyh7IG9wZXJhdGlvbiwgc3VjY2Vzczogc3VjY2Vzcy50b1N0cmluZygpIH0pO1xuXG4gICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICB0aGlzLnJlZGlzT3BlcmF0aW9uRXJyb3JzVG90YWwuaW5jKHsgb3BlcmF0aW9uIH0pO1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9