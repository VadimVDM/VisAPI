4c101754baac43385d132c75cba9df8d
"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.SupabaseHealthIndicator = void 0;
const tslib_1 = require("tslib");
const common_1 = require("@nestjs/common");
const terminus_1 = require("@nestjs/terminus");
const core_supabase_1 = require("@visapi/core-supabase");
let SupabaseHealthIndicator = class SupabaseHealthIndicator extends terminus_1.HealthIndicator {
    constructor(supabase) {
        super();
        this.supabase = supabase;
    }
    isHealthy(key) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            try {
                const isConnected = yield this.supabase.checkConnection();
                if (isConnected) {
                    return this.getStatus(key, true);
                }
                throw new terminus_1.HealthCheckError('Supabase connection failed', this.getStatus(key, false));
            }
            catch (error) {
                throw new terminus_1.HealthCheckError('Supabase connection failed', this.getStatus(key, false));
            }
        });
    }
};
exports.SupabaseHealthIndicator = SupabaseHealthIndicator;
exports.SupabaseHealthIndicator = SupabaseHealthIndicator = tslib_1.__decorate([
    (0, common_1.Injectable)(),
    tslib_1.__metadata("design:paramtypes", [typeof (_a = typeof core_supabase_1.SupabaseService !== "undefined" && core_supabase_1.SupabaseService) === "function" ? _a : Object])
], SupabaseHealthIndicator);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3ZhZGltL1Byb2plY3RzL1Zpc0FQSS9hcHBzL2JhY2tlbmQvc3JjL2hlYWx0aC9pbmRpY2F0b3JzL3N1cGFiYXNlLmhlYWx0aC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLDJDQUE0QztBQUM1QywrQ0FJMEI7QUFDMUIseURBQXdEO0FBR2pELElBQU0sdUJBQXVCLEdBQTdCLE1BQU0sdUJBQXdCLFNBQVEsMEJBQWU7SUFDMUQsWUFBNkIsUUFBeUI7UUFDcEQsS0FBSyxFQUFFLENBQUM7UUFEbUIsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7SUFFdEQsQ0FBQztJQUVLLFNBQVMsQ0FBQyxHQUFXOztZQUN6QixJQUFJLENBQUM7Z0JBQ0gsTUFBTSxXQUFXLEdBQUcsTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUUxRCxJQUFJLFdBQVcsRUFBRSxDQUFDO29CQUNoQixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO2dCQUNuQyxDQUFDO2dCQUVELE1BQU0sSUFBSSwyQkFBZ0IsQ0FDeEIsNEJBQTRCLEVBQzVCLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUMzQixDQUFDO1lBQ0osQ0FBQztZQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7Z0JBQ2YsTUFBTSxJQUFJLDJCQUFnQixDQUN4Qiw0QkFBNEIsRUFDNUIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQzNCLENBQUM7WUFDSixDQUFDO1FBQ0gsQ0FBQztLQUFBO0NBQ0YsQ0FBQTtBQXhCWSwwREFBdUI7a0NBQXZCLHVCQUF1QjtJQURuQyxJQUFBLG1CQUFVLEdBQUU7aUVBRTRCLCtCQUFlLG9CQUFmLCtCQUFlO0dBRDNDLHVCQUF1QixDQXdCbkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3ZhZGltL1Byb2plY3RzL1Zpc0FQSS9hcHBzL2JhY2tlbmQvc3JjL2hlYWx0aC9pbmRpY2F0b3JzL3N1cGFiYXNlLmhlYWx0aC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHtcbiAgSGVhbHRoSW5kaWNhdG9yLFxuICBIZWFsdGhJbmRpY2F0b3JSZXN1bHQsXG4gIEhlYWx0aENoZWNrRXJyb3IsXG59IGZyb20gJ0BuZXN0anMvdGVybWludXMnO1xuaW1wb3J0IHsgU3VwYWJhc2VTZXJ2aWNlIH0gZnJvbSAnQHZpc2FwaS9jb3JlLXN1cGFiYXNlJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFN1cGFiYXNlSGVhbHRoSW5kaWNhdG9yIGV4dGVuZHMgSGVhbHRoSW5kaWNhdG9yIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBzdXBhYmFzZTogU3VwYWJhc2VTZXJ2aWNlKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIGFzeW5jIGlzSGVhbHRoeShrZXk6IHN0cmluZyk6IFByb21pc2U8SGVhbHRoSW5kaWNhdG9yUmVzdWx0PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGlzQ29ubmVjdGVkID0gYXdhaXQgdGhpcy5zdXBhYmFzZS5jaGVja0Nvbm5lY3Rpb24oKTtcblxuICAgICAgaWYgKGlzQ29ubmVjdGVkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFN0YXR1cyhrZXksIHRydWUpO1xuICAgICAgfVxuXG4gICAgICB0aHJvdyBuZXcgSGVhbHRoQ2hlY2tFcnJvcihcbiAgICAgICAgJ1N1cGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJyxcbiAgICAgICAgdGhpcy5nZXRTdGF0dXMoa2V5LCBmYWxzZSlcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBIZWFsdGhDaGVja0Vycm9yKFxuICAgICAgICAnU3VwYWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnLFxuICAgICAgICB0aGlzLmdldFN0YXR1cyhrZXksIGZhbHNlKVxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==