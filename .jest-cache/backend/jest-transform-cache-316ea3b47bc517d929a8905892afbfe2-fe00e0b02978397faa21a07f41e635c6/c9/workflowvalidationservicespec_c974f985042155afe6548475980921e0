4c9853af1513c4780f0b587123d3da98
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const testing_1 = require("@nestjs/testing");
const workflow_validation_service_1 = require("./workflow-validation.service");
describe('WorkflowValidationService', () => {
    let service;
    beforeEach(() => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
        const module = yield testing_1.Test.createTestingModule({
            providers: [workflow_validation_service_1.WorkflowValidationService],
        }).compile();
        service = module.get(workflow_validation_service_1.WorkflowValidationService);
        // Initialize the service (normally called by NestJS)
        service.onModuleInit();
    }));
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('validateWorkflowDefinition', () => {
        it('should validate a correct workflow schema', () => {
            const validWorkflow = {
                id: '550e8400-e29b-41d4-a716-446655440000',
                name: 'Test Workflow',
                description: 'A test workflow',
                enabled: true,
                variables: { testVar: 'value' },
                triggers: [
                    {
                        type: 'cron',
                        config: {
                            schedule: '0 9 * * *',
                        },
                    },
                ],
                steps: [
                    {
                        id: 'step-1',
                        type: 'whatsapp.send',
                        config: {
                            contact: '+1234567890',
                            template: 'test_template',
                        },
                        retries: 3,
                    },
                ],
            };
            const result = service.validateWorkflowDefinition(validWorkflow);
            expect(result.valid).toBe(true);
            expect(result.errors).toBeUndefined();
        });
        it('should reject workflow with missing required fields', () => {
            const invalidWorkflow = {
                name: 'Test Workflow',
                // Missing required fields: triggers, steps, enabled
            };
            const result = service.validateWorkflowDefinition(invalidWorkflow);
            expect(result.valid).toBe(false);
            expect(result.errors).toBeDefined();
            expect(result.errors.length).toBeGreaterThan(0);
        });
        it('should reject workflow with invalid step type', () => {
            const invalidWorkflow = {
                name: 'Test Workflow',
                enabled: true,
                triggers: [
                    {
                        type: 'cron',
                        config: {
                            schedule: '0 9 * * *',
                        },
                    },
                ],
                steps: [
                    {
                        id: 'step-1',
                        type: 'invalid.type',
                        config: {},
                    },
                ],
            };
            const result = service.validateWorkflowDefinition(invalidWorkflow);
            expect(result.valid).toBe(false);
            expect(result.errors).toBeDefined();
            expect(result.errors.some(error => error.includes('invalid.type'))).toBe(true);
        });
        it('should reject workflow with invalid phone number format', () => {
            const invalidWorkflow = {
                name: 'Test Workflow',
                enabled: true,
                triggers: [
                    {
                        type: 'cron',
                        config: {
                            schedule: '0 9 * * *',
                        },
                    },
                ],
                steps: [
                    {
                        id: 'step-1',
                        type: 'whatsapp.send',
                        config: {
                            contact: 'invalid-phone',
                            template: 'test_template',
                        },
                    },
                ],
            };
            const result = service.validateWorkflowDefinition(invalidWorkflow);
            expect(result.valid).toBe(false);
            expect(result.errors).toBeDefined();
        });
        it('should reject workflow with empty steps array', () => {
            const invalidWorkflow = {
                name: 'Test Workflow',
                enabled: true,
                triggers: [
                    {
                        type: 'cron',
                        config: {
                            schedule: '0 9 * * *',
                        },
                    },
                ],
                steps: [],
            };
            const result = service.validateWorkflowDefinition(invalidWorkflow);
            expect(result.valid).toBe(false);
            expect(result.errors).toBeDefined();
            expect(result.errors.some(error => error.includes('minItems'))).toBe(true);
        });
    });
    describe('validateStepConfig', () => {
        it('should validate slack.send step config', () => {
            const config = {
                channel: '#general',
                message: 'Test message',
            };
            const result = service.validateStepConfig('slack.send', config);
            expect(result.valid).toBe(true);
        });
        it('should validate whatsapp.send step config', () => {
            const config = {
                contact: '+1234567890',
                template: 'test_template',
            };
            const result = service.validateStepConfig('whatsapp.send', config);
            expect(result.valid).toBe(true);
        });
        it('should validate pdf.generate step config', () => {
            const config = {
                template: 'visa_certificate',
                data: { name: 'John Doe' },
            };
            const result = service.validateStepConfig('pdf.generate', config);
            expect(result.valid).toBe(true);
        });
        it('should validate email.send step config', () => {
            const config = {
                recipient: 'test@example.com',
                subject: 'Test Email',
            };
            const result = service.validateStepConfig('email.send', config);
            expect(result.valid).toBe(true);
        });
        it('should reject unknown step type', () => {
            const config = {};
            const result = service.validateStepConfig('unknown.type', config);
            expect(result.valid).toBe(false);
            expect(result.errors).toBeDefined();
            expect(result.errors[0]).toContain('Unknown step type');
        });
        it('should reject whatsapp.send with missing contact', () => {
            const config = {
                template: 'test_template',
            };
            const result = service.validateStepConfig('whatsapp.send', config);
            expect(result.valid).toBe(false);
            expect(result.errors).toBeDefined();
            expect(result.errors[0]).toContain('contact');
        });
        it('should reject whatsapp.send with invalid phone format', () => {
            const config = {
                contact: 'invalid-phone',
                template: 'test_template',
            };
            const result = service.validateStepConfig('whatsapp.send', config);
            expect(result.valid).toBe(false);
            expect(result.errors).toBeDefined();
            expect(result.errors[0]).toContain('phone number format');
        });
        it('should reject email.send with invalid email format', () => {
            const config = {
                recipient: 'invalid-email',
                subject: 'Test',
            };
            const result = service.validateStepConfig('email.send', config);
            expect(result.valid).toBe(false);
            expect(result.errors).toBeDefined();
            expect(result.errors[0]).toContain('email format');
        });
    });
    describe('validateCronExpression', () => {
        it('should validate correct cron expressions', () => {
            const validCronExpressions = [
                '0 9 * * *',
                '0 9 * * 1-5',
                '*/15 * * * *',
                '0 0 1 * *',
                '0 9,17 * * *',
            ];
            validCronExpressions.forEach(expression => {
                const result = service.validateCronExpression(expression);
                expect(result.valid).toBe(true);
            });
        });
        it('should reject invalid cron expressions', () => {
            const invalidCronExpressions = [
                'invalid',
                '0 9',
                '0 9 * * * * *',
                '60 9 * * *',
                '',
            ];
            invalidCronExpressions.forEach(expression => {
                const result = service.validateCronExpression(expression);
                expect(result.valid).toBe(false);
            });
        });
    });
    describe('validateUniqueStepIds', () => {
        it('should validate unique step IDs', () => {
            const steps = [
                { id: 'step-1' },
                { id: 'step-2' },
                { id: 'step-3' },
            ];
            const result = service.validateUniqueStepIds(steps);
            expect(result.valid).toBe(true);
        });
        it('should reject duplicate step IDs', () => {
            const steps = [
                { id: 'step-1' },
                { id: 'step-2' },
                { id: 'step-1' },
            ];
            const result = service.validateUniqueStepIds(steps);
            expect(result.valid).toBe(false);
            expect(result.errors).toBeDefined();
            expect(result.errors[0]).toContain('Duplicate step IDs');
        });
    });
    describe('validateCompleteWorkflow', () => {
        it('should validate a complete valid workflow', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const validWorkflow = {
                id: '550e8400-e29b-41d4-a716-446655440000',
                name: 'Test Workflow',
                description: 'A test workflow',
                enabled: true,
                variables: { testVar: 'value' },
                triggers: [
                    {
                        type: 'cron',
                        config: {
                            schedule: '0 9 * * *',
                        },
                    },
                ],
                steps: [
                    {
                        id: 'step-1',
                        type: 'whatsapp.send',
                        config: {
                            contact: '+1234567890',
                            template: 'test_template',
                        },
                        retries: 3,
                    },
                ],
            };
            const result = yield service.validateCompleteWorkflow(validWorkflow);
            expect(result.valid).toBe(true);
        }));
        it('should reject workflow with duplicate step IDs', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const invalidWorkflow = {
                name: 'Test Workflow',
                enabled: true,
                triggers: [
                    {
                        type: 'cron',
                        config: {
                            schedule: '0 9 * * *',
                        },
                    },
                ],
                steps: [
                    {
                        id: 'step-1',
                        type: 'whatsapp.send',
                        config: {
                            contact: '+1234567890',
                            template: 'test_template',
                        },
                    },
                    {
                        id: 'step-1',
                        type: 'slack.send',
                        config: {
                            channel: '#general',
                            message: 'Test',
                        },
                    },
                ],
            };
            const result = yield service.validateCompleteWorkflow(invalidWorkflow);
            expect(result.valid).toBe(false);
            expect(result.errors).toBeDefined();
            expect(result.errors[0]).toContain('Duplicate step IDs');
        }));
        it('should reject workflow with invalid cron schedule', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const invalidWorkflow = {
                name: 'Test Workflow',
                enabled: true,
                triggers: [
                    {
                        type: 'cron',
                        config: {
                            schedule: 'invalid-cron',
                        },
                    },
                ],
                steps: [
                    {
                        id: 'step-1',
                        type: 'whatsapp.send',
                        config: {
                            contact: '+1234567890',
                            template: 'test_template',
                        },
                    },
                ],
            };
            const result = yield service.validateCompleteWorkflow(invalidWorkflow);
            expect(result.valid).toBe(false);
            expect(result.errors).toBeDefined();
            expect(result.errors[0]).toContain('Cron trigger');
        }));
        it('should reject workflow with invalid step configuration', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const invalidWorkflow = {
                name: 'Test Workflow',
                enabled: true,
                triggers: [
                    {
                        type: 'cron',
                        config: {
                            schedule: '0 9 * * *',
                        },
                    },
                ],
                steps: [
                    {
                        id: 'step-1',
                        type: 'whatsapp.send',
                        config: {
                            contact: 'invalid-phone',
                            template: 'test_template',
                        },
                    },
                ],
            };
            const result = yield service.validateCompleteWorkflow(invalidWorkflow);
            expect(result.valid).toBe(false);
            expect(result.errors).toBeDefined();
            expect(result.errors[0]).toContain('contact');
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3ZhZGltL1Byb2plY3RzL1Zpc0FQSS9hcHBzL2JhY2tlbmQvc3JjL3dvcmtmbG93cy9zZXJ2aWNlcy93b3JrZmxvdy12YWxpZGF0aW9uLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSw2Q0FBc0Q7QUFDdEQsK0VBQTBFO0FBRzFFLFFBQVEsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7SUFDekMsSUFBSSxPQUFrQyxDQUFDO0lBRXZDLFVBQVUsQ0FBQyxHQUFTLEVBQUU7UUFDcEIsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFNBQVMsRUFBRSxDQUFDLHVEQUF5QixDQUFDO1NBQ3ZDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUViLE9BQU8sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUE0Qix1REFBeUIsQ0FBQyxDQUFDO1FBQzNFLHFEQUFxRDtRQUNyRCxPQUFPLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDekIsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO1FBQzFDLEVBQUUsQ0FBQywyQ0FBMkMsRUFBRSxHQUFHLEVBQUU7WUFDbkQsTUFBTSxhQUFhLEdBQW1CO2dCQUNwQyxFQUFFLEVBQUUsc0NBQXNDO2dCQUMxQyxJQUFJLEVBQUUsZUFBZTtnQkFDckIsV0FBVyxFQUFFLGlCQUFpQjtnQkFDOUIsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsU0FBUyxFQUFFLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRTtnQkFDL0IsUUFBUSxFQUFFO29CQUNSO3dCQUNFLElBQUksRUFBRSxNQUFNO3dCQUNaLE1BQU0sRUFBRTs0QkFDTixRQUFRLEVBQUUsV0FBVzt5QkFDdEI7cUJBQ0Y7aUJBQ0Y7Z0JBQ0QsS0FBSyxFQUFFO29CQUNM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USxFQUFFLFdBQVc7eUJBQ3RCO3FCQUNGO2lCQUNGO2dCQUNELEtBQUssRUFBRTtvQkFDTDt3QkFDRSxFQUFFLEVBQUUsUUFBUTt3QkFDWixJQUFJLEVBQUUsZUFBZTt3QkFDckIsTUFBTSxFQUFFOzRCQUNOLE9BQU8sRUFBRSxlQUFlOzRCQUN4QixRQUFRLEVBQUUsZUFBZTt5QkFDMUI7cUJBQ0Y7aUJBQ0Y7YUFDRixDQUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsd0JBQXdCLENBQUMsZUFBZSxDQUFDLENBQUM7WUFFdkUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDakMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNwQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNqRCxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvdmFkaW0vUHJvamVjdHMvVmlzQVBJL2FwcHMvYmFja2VuZC9zcmMvd29ya2Zsb3dzL3NlcnZpY2VzL3dvcmtmbG93LXZhbGlkYXRpb24uc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgV29ya2Zsb3dWYWxpZGF0aW9uU2VydmljZSB9IGZyb20gJy4vd29ya2Zsb3ctdmFsaWRhdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IFdvcmtmbG93U2NoZW1hIH0gZnJvbSAnQHZpc2FwaS9zaGFyZWQtdHlwZXMnO1xuXG5kZXNjcmliZSgnV29ya2Zsb3dWYWxpZGF0aW9uU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IFdvcmtmbG93VmFsaWRhdGlvblNlcnZpY2U7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1dvcmtmbG93VmFsaWRhdGlvblNlcnZpY2VdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PFdvcmtmbG93VmFsaWRhdGlvblNlcnZpY2U+KFdvcmtmbG93VmFsaWRhdGlvblNlcnZpY2UpO1xuICAgIC8vIEluaXRpYWxpemUgdGhlIHNlcnZpY2UgKG5vcm1hbGx5IGNhbGxlZCBieSBOZXN0SlMpXG4gICAgc2VydmljZS5vbk1vZHVsZUluaXQoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZhbGlkYXRlV29ya2Zsb3dEZWZpbml0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYSBjb3JyZWN0IHdvcmtmbG93IHNjaGVtYScsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkV29ya2Zsb3c6IFdvcmtmbG93U2NoZW1hID0ge1xuICAgICAgICBpZDogJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsXG4gICAgICAgIG5hbWU6ICdUZXN0IFdvcmtmbG93JyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdBIHRlc3Qgd29ya2Zsb3cnLFxuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICB2YXJpYWJsZXM6IHsgdGVzdFZhcjogJ3ZhbHVlJyB9LFxuICAgICAgICB0cmlnZ2VyczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6ICdjcm9uJyxcbiAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICBzY2hlZHVsZTogJzAgOSAqICogKicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHN0ZXBzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6ICdzdGVwLTEnLFxuICAgICAgICAgICAgdHlwZTogJ3doYXRzYXBwLnNlbmQnLFxuICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgIGNvbnRhY3Q6ICcrMTIzNDU2Nzg5MCcsXG4gICAgICAgICAgICAgIHRlbXBsYXRlOiAndGVzdF90ZW1wbGF0ZScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0cmllczogMyxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS52YWxpZGF0ZVdvcmtmbG93RGVmaW5pdGlvbih2YWxpZFdvcmtmbG93KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCB3b3JrZmxvdyB3aXRoIG1pc3NpbmcgcmVxdWlyZWQgZmllbGRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZFdvcmtmbG93ID0ge1xuICAgICAgICBuYW1lOiAnVGVzdCBXb3JrZmxvdycsXG4gICAgICAgIC8vIE1pc3NpbmcgcmVxdWlyZWQgZmllbGRzOiB0cmlnZ2Vycywgc3RlcHMsIGVuYWJsZWRcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHNlcnZpY2UudmFsaWRhdGVXb3JrZmxvd0RlZmluaXRpb24oaW52YWxpZFdvcmtmbG93KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzIS5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHdvcmtmbG93IHdpdGggaW52YWxpZCBzdGVwIHR5cGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkV29ya2Zsb3cgPSB7XG4gICAgICAgIG5hbWU6ICdUZXN0IFdvcmtmbG93JyxcbiAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgdHJpZ2dlcnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAnY3JvbicsXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgc2NoZWR1bGU6ICcwIDkgKiAqIConLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICBzdGVwczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAnc3RlcC0xJyxcbiAgICAgICAgICAgIHR5cGU6ICdpbnZhbGlkLnR5cGUnLFxuICAgICAgICAgICAgY29uZmlnOiB7fSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS52YWxpZGF0ZVdvcmtmbG93RGVmaW5pdGlvbihpbnZhbGlkV29ya2Zsb3cpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcnMhLnNvbWUoZXJyb3IgPT4gZXJyb3IuaW5jbHVkZXMoJ2ludmFsaWQudHlwZScpKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHdvcmtmbG93IHdpdGggaW52YWxpZCBwaG9uZSBudW1iZXIgZm9ybWF0JywgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZFdvcmtmbG93ID0ge1xuICAgICAgICBuYW1lOiAnVGVzdCBXb3JrZmxvdycsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIHRyaWdnZXJzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogJ2Nyb24nLFxuICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgIHNjaGVkdWxlOiAnMCA5ICogKiAqJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgc3RlcHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogJ3N0ZXAtMScsXG4gICAgICAgICAgICB0eXBlOiAnd2hhdHNhcHAuc2VuZCcsXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgY29udGFjdDogJ2ludmFsaWQtcGhvbmUnLFxuICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3Rlc3RfdGVtcGxhdGUnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS52YWxpZGF0ZVdvcmtmbG93RGVmaW5pdGlvbihpbnZhbGlkV29ya2Zsb3cpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3Qgd29ya2Zsb3cgd2l0aCBlbXB0eSBzdGVwcyBhcnJheScsICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRXb3JrZmxvdyA9IHtcbiAgICAgICAgbmFtZTogJ1Rlc3QgV29ya2Zsb3cnLFxuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICB0cmlnZ2VyczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6ICdjcm9uJyxcbiAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICBzY2hlZHVsZTogJzAgOSAqICogKicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHN0ZXBzOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHNlcnZpY2UudmFsaWRhdGVXb3JrZmxvd0RlZmluaXRpb24oaW52YWxpZFdvcmtmbG93KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzIS5zb21lKGVycm9yID0+IGVycm9yLmluY2x1ZGVzKCdtaW5JdGVtcycpKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZhbGlkYXRlU3RlcENvbmZpZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHNsYWNrLnNlbmQgc3RlcCBjb25maWcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIGNoYW5uZWw6ICcjZ2VuZXJhbCcsXG4gICAgICAgIG1lc3NhZ2U6ICdUZXN0IG1lc3NhZ2UnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS52YWxpZGF0ZVN0ZXBDb25maWcoJ3NsYWNrLnNlbmQnLCBjb25maWcpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSB3aGF0c2FwcC5zZW5kIHN0ZXAgY29uZmlnJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBjb250YWN0OiAnKzEyMzQ1Njc4OTAnLFxuICAgICAgICB0ZW1wbGF0ZTogJ3Rlc3RfdGVtcGxhdGUnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS52YWxpZGF0ZVN0ZXBDb25maWcoJ3doYXRzYXBwLnNlbmQnLCBjb25maWcpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBwZGYuZ2VuZXJhdGUgc3RlcCBjb25maWcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIHRlbXBsYXRlOiAndmlzYV9jZXJ0aWZpY2F0ZScsXG4gICAgICAgIGRhdGE6IHsgbmFtZTogJ0pvaG4gRG9lJyB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS52YWxpZGF0ZVN0ZXBDb25maWcoJ3BkZi5nZW5lcmF0ZScsIGNvbmZpZyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGVtYWlsLnNlbmQgc3RlcCBjb25maWcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIHJlY2lwaWVudDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICBzdWJqZWN0OiAnVGVzdCBFbWFpbCcsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBzZXJ2aWNlLnZhbGlkYXRlU3RlcENvbmZpZygnZW1haWwuc2VuZCcsIGNvbmZpZyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCB1bmtub3duIHN0ZXAgdHlwZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHt9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBzZXJ2aWNlLnZhbGlkYXRlU3RlcENvbmZpZygndW5rbm93bi50eXBlJywgY29uZmlnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzIVswXSkudG9Db250YWluKCdVbmtub3duIHN0ZXAgdHlwZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3Qgd2hhdHNhcHAuc2VuZCB3aXRoIG1pc3NpbmcgY29udGFjdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgdGVtcGxhdGU6ICd0ZXN0X3RlbXBsYXRlJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHNlcnZpY2UudmFsaWRhdGVTdGVwQ29uZmlnKCd3aGF0c2FwcC5zZW5kJywgY29uZmlnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzIVswXSkudG9Db250YWluKCdjb250YWN0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCB3aGF0c2FwcC5zZW5kIHdpdGggaW52YWxpZCBwaG9uZSBmb3JtYXQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIGNvbnRhY3Q6ICdpbnZhbGlkLXBob25lJyxcbiAgICAgICAgdGVtcGxhdGU6ICd0ZXN0X3RlbXBsYXRlJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHNlcnZpY2UudmFsaWRhdGVTdGVwQ29uZmlnKCd3aGF0c2FwcC5zZW5kJywgY29uZmlnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzIVswXSkudG9Db250YWluKCdwaG9uZSBudW1iZXIgZm9ybWF0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBlbWFpbC5zZW5kIHdpdGggaW52YWxpZCBlbWFpbCBmb3JtYXQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIHJlY2lwaWVudDogJ2ludmFsaWQtZW1haWwnLFxuICAgICAgICBzdWJqZWN0OiAnVGVzdCcsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBzZXJ2aWNlLnZhbGlkYXRlU3RlcENvbmZpZygnZW1haWwuc2VuZCcsIGNvbmZpZyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcnMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycyFbMF0pLnRvQ29udGFpbignZW1haWwgZm9ybWF0Jyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZUNyb25FeHByZXNzaW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgY29ycmVjdCBjcm9uIGV4cHJlc3Npb25zJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsaWRDcm9uRXhwcmVzc2lvbnMgPSBbXG4gICAgICAgICcwIDkgKiAqIConLFxuICAgICAgICAnMCA5ICogKiAxLTUnLFxuICAgICAgICAnKi8xNSAqICogKiAqJyxcbiAgICAgICAgJzAgMCAxICogKicsXG4gICAgICAgICcwIDksMTcgKiAqIConLFxuICAgICAgXTtcblxuICAgICAgdmFsaWRDcm9uRXhwcmVzc2lvbnMuZm9yRWFjaChleHByZXNzaW9uID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS52YWxpZGF0ZUNyb25FeHByZXNzaW9uKGV4cHJlc3Npb24pO1xuICAgICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBpbnZhbGlkIGNyb24gZXhwcmVzc2lvbnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkQ3JvbkV4cHJlc3Npb25zID0gW1xuICAgICAgICAnaW52YWxpZCcsXG4gICAgICAgICcwIDknLFxuICAgICAgICAnMCA5ICogKiAqICogKicsXG4gICAgICAgICc2MCA5ICogKiAqJyxcbiAgICAgICAgJycsXG4gICAgICBdO1xuXG4gICAgICBpbnZhbGlkQ3JvbkV4cHJlc3Npb25zLmZvckVhY2goZXhwcmVzc2lvbiA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHNlcnZpY2UudmFsaWRhdGVDcm9uRXhwcmVzc2lvbihleHByZXNzaW9uKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZhbGlkYXRlVW5pcXVlU3RlcElkcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHVuaXF1ZSBzdGVwIElEcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0ZXBzID0gW1xuICAgICAgICB7IGlkOiAnc3RlcC0xJyB9LFxuICAgICAgICB7IGlkOiAnc3RlcC0yJyB9LFxuICAgICAgICB7IGlkOiAnc3RlcC0zJyB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS52YWxpZGF0ZVVuaXF1ZVN0ZXBJZHMoc3RlcHMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgZHVwbGljYXRlIHN0ZXAgSURzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RlcHMgPSBbXG4gICAgICAgIHsgaWQ6ICdzdGVwLTEnIH0sXG4gICAgICAgIHsgaWQ6ICdzdGVwLTInIH0sXG4gICAgICAgIHsgaWQ6ICdzdGVwLTEnIH0sXG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBzZXJ2aWNlLnZhbGlkYXRlVW5pcXVlU3RlcElkcyhzdGVwcyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcnMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycyFbMF0pLnRvQ29udGFpbignRHVwbGljYXRlIHN0ZXAgSURzJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZUNvbXBsZXRlV29ya2Zsb3cnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhIGNvbXBsZXRlIHZhbGlkIHdvcmtmbG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsaWRXb3JrZmxvdzogV29ya2Zsb3dTY2hlbWEgPSB7XG4gICAgICAgIGlkOiAnNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwJyxcbiAgICAgICAgbmFtZTogJ1Rlc3QgV29ya2Zsb3cnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0EgdGVzdCB3b3JrZmxvdycsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIHZhcmlhYmxlczogeyB0ZXN0VmFyOiAndmFsdWUnIH0sXG4gICAgICAgIHRyaWdnZXJzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogJ2Nyb24nLFxuICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgIHNjaGVkdWxlOiAnMCA5ICogKiAqJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgc3RlcHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogJ3N0ZXAtMScsXG4gICAgICAgICAgICB0eXBlOiAnd2hhdHNhcHAuc2VuZCcsXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgY29udGFjdDogJysxMjM0NTY3ODkwJyxcbiAgICAgICAgICAgICAgdGVtcGxhdGU6ICd0ZXN0X3RlbXBsYXRlJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXRyaWVzOiAzLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnZhbGlkYXRlQ29tcGxldGVXb3JrZmxvdyh2YWxpZFdvcmtmbG93KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHdvcmtmbG93IHdpdGggZHVwbGljYXRlIHN0ZXAgSURzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZFdvcmtmbG93ID0ge1xuICAgICAgICBuYW1lOiAnVGVzdCBXb3JrZmxvdycsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIHRyaWdnZXJzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogJ2Nyb24nLFxuICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgIHNjaGVkdWxlOiAnMCA5ICogKiAqJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgc3RlcHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogJ3N0ZXAtMScsXG4gICAgICAgICAgICB0eXBlOiAnd2hhdHNhcHAuc2VuZCcsXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgY29udGFjdDogJysxMjM0NTY3ODkwJyxcbiAgICAgICAgICAgICAgdGVtcGxhdGU6ICd0ZXN0X3RlbXBsYXRlJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogJ3N0ZXAtMScsXG4gICAgICAgICAgICB0eXBlOiAnc2xhY2suc2VuZCcsXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgY2hhbm5lbDogJyNnZW5lcmFsJyxcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ1Rlc3QnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52YWxpZGF0ZUNvbXBsZXRlV29ya2Zsb3coaW52YWxpZFdvcmtmbG93KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzIVswXSkudG9Db250YWluKCdEdXBsaWNhdGUgc3RlcCBJRHMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHdvcmtmbG93IHdpdGggaW52YWxpZCBjcm9uIHNjaGVkdWxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZFdvcmtmbG93ID0ge1xuICAgICAgICBuYW1lOiAnVGVzdCBXb3JrZmxvdycsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIHRyaWdnZXJzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogJ2Nyb24nLFxuICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgIHNjaGVkdWxlOiAnaW52YWxpZC1jcm9uJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgc3RlcHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogJ3N0ZXAtMScsXG4gICAgICAgICAgICB0eXBlOiAnd2hhdHNhcHAuc2VuZCcsXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgY29udGFjdDogJysxMjM0NTY3ODkwJyxcbiAgICAgICAgICAgICAgdGVtcGxhdGU6ICd0ZXN0X3RlbXBsYXRlJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudmFsaWRhdGVDb21wbGV0ZVdvcmtmbG93KGludmFsaWRXb3JrZmxvdyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcnMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycyFbMF0pLnRvQ29udGFpbignQ3JvbiB0cmlnZ2VyJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCB3b3JrZmxvdyB3aXRoIGludmFsaWQgc3RlcCBjb25maWd1cmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZFdvcmtmbG93ID0ge1xuICAgICAgICBuYW1lOiAnVGVzdCBXb3JrZmxvdycsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIHRyaWdnZXJzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogJ2Nyb24nLFxuICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgIHNjaGVkdWxlOiAnMCA5ICogKiAqJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgc3RlcHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogJ3N0ZXAtMScsXG4gICAgICAgICAgICB0eXBlOiAnd2hhdHNhcHAuc2VuZCcsXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgY29udGFjdDogJ2ludmFsaWQtcGhvbmUnLFxuICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3Rlc3RfdGVtcGxhdGUnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52YWxpZGF0ZUNvbXBsZXRlV29ya2Zsb3coaW52YWxpZFdvcmtmbG93KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzIVswXSkudG9Db250YWluKCdjb250YWN0Jyk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9