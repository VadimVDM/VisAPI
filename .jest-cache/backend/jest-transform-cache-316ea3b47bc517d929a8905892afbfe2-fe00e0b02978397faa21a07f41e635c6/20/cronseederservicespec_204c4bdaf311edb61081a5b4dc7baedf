f70f183d07b572f08fb209e69acd90ce
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const testing_1 = require("@nestjs/testing");
const cron_seeder_service_1 = require("./cron-seeder.service");
const core_supabase_1 = require("@visapi/core-supabase");
const queue_service_1 = require("../queue/queue.service");
const nestjs_pino_1 = require("nestjs-pino");
const shared_types_1 = require("@visapi/shared-types");
describe('CronSeederService', () => {
    let service;
    let supabaseService;
    let queueService;
    const mockLogger = {
        info: jest.fn(),
        error: jest.fn(),
        warn: jest.fn(),
    };
    const mockWorkflows = [
        {
            id: 'workflow-1',
            name: 'Daily Status Update',
            enabled: true,
            schema: {
                triggers: [
                    {
                        type: 'cron',
                        config: {
                            schedule: '0 9 * * *', // Daily at 9 AM
                            timezone: 'America/New_York',
                        },
                    },
                ],
                steps: [],
            },
        },
        {
            id: 'workflow-2',
            name: 'Weekly Report',
            enabled: true,
            schema: {
                triggers: [
                    {
                        type: 'cron',
                        config: {
                            schedule: '0 10 * * 1', // Weekly on Monday at 10 AM
                        },
                    },
                ],
                steps: [],
            },
        },
        {
            id: 'workflow-3',
            name: 'Webhook Only',
            enabled: true,
            schema: {
                triggers: [
                    {
                        type: 'webhook',
                        config: {
                            endpoint: '/webhook/test',
                        },
                    },
                ],
                steps: [],
            },
        },
    ];
    beforeEach(() => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
        const module = yield testing_1.Test.createTestingModule({
            providers: [
                cron_seeder_service_1.CronSeederService,
                {
                    provide: (0, nestjs_pino_1.getLoggerToken)(cron_seeder_service_1.CronSeederService.name),
                    useValue: mockLogger,
                },
                {
                    provide: core_supabase_1.SupabaseService,
                    useValue: {
                        client: {
                            from: jest.fn().mockReturnValue({
                                select: jest.fn().mockReturnValue({
                                    eq: jest.fn().mockReturnValue({
                                        data: null,
                                        error: null,
                                    }),
                                    single: jest.fn().mockReturnValue({
                                        data: null,
                                        error: null,
                                    }),
                                }),
                            }),
                        },
                    },
                },
                {
                    provide: queue_service_1.QueueService,
                    useValue: {
                        addRepeatableJob: jest.fn(),
                        removeRepeatableJob: jest.fn(),
                        getRepeatableJobs: jest.fn(),
                    },
                },
            ],
        }).compile();
        service = module.get(cron_seeder_service_1.CronSeederService);
        supabaseService = module.get(core_supabase_1.SupabaseService);
        queueService = module.get(queue_service_1.QueueService);
        // Reset mocks
        jest.clearAllMocks();
    }));
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('onModuleInit', () => {
        it('should seed cron jobs on module initialization', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const mockFrom = {
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockResolvedValue({
                        data: mockWorkflows,
                        error: null,
                    }),
                }),
            };
            supabaseService.client.from = jest.fn().mockReturnValue(mockFrom);
            queueService.getRepeatableJobs.mockResolvedValue([]);
            yield service.onModuleInit();
            expect(mockLogger.info).toHaveBeenCalledWith('Starting cron job seeding');
            expect(queueService.addRepeatableJob).toHaveBeenCalledTimes(3); // 2 workflow jobs + 1 log pruning job
            expect(mockLogger.info).toHaveBeenCalledWith('Cron job seeding completed successfully');
        }));
        it('should handle no workflows with cron triggers', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const mockFrom = {
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockResolvedValue({
                        data: [mockWorkflows[2]], // Only webhook workflow
                        error: null,
                    }),
                }),
            };
            supabaseService.client.from = jest.fn().mockReturnValue(mockFrom);
            yield service.onModuleInit();
            expect(mockLogger.info).toHaveBeenCalledWith('No workflows with cron triggers found');
            expect(queueService.addRepeatableJob).toHaveBeenCalledTimes(1); // Only log pruning job
        }));
        it('should handle database errors', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const error = new Error('Database connection failed');
            const mockFrom = {
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockResolvedValue({
                        data: null,
                        error: { message: error.message },
                    }),
                }),
            };
            supabaseService.client.from = jest.fn().mockReturnValue(mockFrom);
            yield expect(service.onModuleInit()).rejects.toThrow('Failed to fetch workflows: Database connection failed');
        }));
    });
    describe('seedCronJobs', () => {
        it('should schedule workflows with cron triggers', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const mockFrom = {
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockResolvedValue({
                        data: mockWorkflows,
                        error: null,
                    }),
                }),
            };
            supabaseService.client.from = jest.fn().mockReturnValue(mockFrom);
            queueService.getRepeatableJobs.mockResolvedValue([]);
            yield service.seedCronJobs();
            expect(queueService.addRepeatableJob).toHaveBeenCalledWith(shared_types_1.QUEUE_NAMES.DEFAULT, shared_types_1.JOB_NAMES.PROCESS_WORKFLOW, {
                workflowId: 'workflow-1',
                trigger: {
                    type: 'cron',
                    schedule: '0 9 * * *',
                },
                metadata: {
                    workflowName: 'Daily Status Update',
                    scheduledBy: 'cron-seeder',
                },
            }, {
                pattern: '0 9 * * *',
                tz: 'America/New_York',
            });
            expect(queueService.addRepeatableJob).toHaveBeenCalledWith(shared_types_1.QUEUE_NAMES.DEFAULT, shared_types_1.JOB_NAMES.PROCESS_WORKFLOW, {
                workflowId: 'workflow-2',
                trigger: {
                    type: 'cron',
                    schedule: '0 10 * * 1',
                },
                metadata: {
                    workflowName: 'Weekly Report',
                    scheduledBy: 'cron-seeder',
                },
            }, {
                pattern: '0 10 * * 1',
                tz: 'UTC',
            });
            // Verify log pruning job is scheduled
            expect(queueService.addRepeatableJob).toHaveBeenCalledWith(shared_types_1.QUEUE_NAMES.DEFAULT, shared_types_1.JOB_NAMES.PRUNE_LOGS, {
                olderThanDays: 90,
            }, {
                pattern: '0 2 * * *',
                tz: 'UTC',
            });
        }));
        it('should clear existing cron jobs before seeding', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const existingJobs = [
                { id: 'cron-workflow-1', key: 'key1' },
                { id: 'cron-workflow-2', key: 'key2' },
                { id: 'log-pruning', key: 'key3' },
                { id: 'other-job', key: 'key4' },
            ];
            const mockFrom = {
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockResolvedValue({
                        data: mockWorkflows,
                        error: null,
                    }),
                }),
            };
            supabaseService.client.from = jest.fn().mockReturnValue(mockFrom);
            queueService.getRepeatableJobs.mockResolvedValue(existingJobs);
            yield service.seedCronJobs();
            expect(queueService.removeRepeatableJob).toHaveBeenCalledWith(shared_types_1.QUEUE_NAMES.DEFAULT, 'workflow-1');
            expect(queueService.removeRepeatableJob).toHaveBeenCalledWith(shared_types_1.QUEUE_NAMES.DEFAULT, 'workflow-2');
            expect(queueService.removeRepeatableJob).toHaveBeenCalledWith(shared_types_1.QUEUE_NAMES.DEFAULT, 'log-pruning');
            expect(queueService.removeRepeatableJob).toHaveBeenCalledTimes(3);
        }));
    });
    describe('updateWorkflowCronJobs', () => {
        it('should update cron jobs for an enabled workflow', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const updatedWorkflow = Object.assign(Object.assign({}, mockWorkflows[0]), { schema: {
                    triggers: [
                        {
                            type: 'cron',
                            config: {
                                schedule: '0 15 * * *', // Updated schedule
                                timezone: 'UTC',
                            },
                        },
                    ],
                    steps: [],
                } });
            const mockFrom = {
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        single: jest.fn().mockResolvedValue({
                            data: updatedWorkflow,
                            error: null,
                        }),
                    }),
                }),
            };
            supabaseService.client.from = jest.fn().mockReturnValue(mockFrom);
            yield service.updateWorkflowCronJobs('workflow-1');
            expect(queueService.removeRepeatableJob).toHaveBeenCalledWith(shared_types_1.QUEUE_NAMES.DEFAULT, 'workflow-1');
            expect(queueService.addRepeatableJob).toHaveBeenCalledWith(shared_types_1.QUEUE_NAMES.DEFAULT, shared_types_1.JOB_NAMES.PROCESS_WORKFLOW, expect.objectContaining({
                workflowId: 'workflow-1',
            }), {
                pattern: '0 15 * * *',
                tz: 'UTC',
            });
        }));
        it('should not reschedule disabled workflows', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const disabledWorkflow = Object.assign(Object.assign({}, mockWorkflows[0]), { enabled: false });
            const mockFrom = {
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        single: jest.fn().mockResolvedValue({
                            data: disabledWorkflow,
                            error: null,
                        }),
                    }),
                }),
            };
            supabaseService.client.from = jest.fn().mockReturnValue(mockFrom);
            yield service.updateWorkflowCronJobs('workflow-1');
            expect(queueService.removeRepeatableJob).toHaveBeenCalled();
            expect(queueService.addRepeatableJob).not.toHaveBeenCalled();
        }));
        it('should handle workflow not found', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const mockFrom = {
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        single: jest.fn().mockResolvedValue({
                            data: null,
                            error: { message: 'Not found' },
                        }),
                    }),
                }),
            };
            supabaseService.client.from = jest.fn().mockReturnValue(mockFrom);
            yield service.updateWorkflowCronJobs('non-existent');
            expect(mockLogger.warn).toHaveBeenCalledWith(expect.objectContaining({
                workflowId: 'non-existent',
            }), 'Workflow not found for cron update');
        }));
    });
    describe('removeWorkflowCronJobs', () => {
        it('should remove cron jobs for a workflow', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield service.removeWorkflowCronJobs('workflow-1');
            expect(queueService.removeRepeatableJob).toHaveBeenCalledWith(shared_types_1.QUEUE_NAMES.DEFAULT, 'workflow-1');
            expect(mockLogger.info).toHaveBeenCalledWith({ workflowId: 'workflow-1' }, 'Removed cron jobs for workflow');
        }));
        it('should handle errors when removing cron jobs', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const error = new Error('Failed to remove');
            queueService.removeRepeatableJob.mockRejectedValue(error);
            yield service.removeWorkflowCronJobs('workflow-1');
            expect(mockLogger.error).toHaveBeenCalledWith({ error, workflowId: 'workflow-1' }, 'Failed to remove workflow cron jobs');
        }));
    });
    describe('getCronDriftMetrics', () => {
        it('should calculate cron drift metrics', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const now = new Date();
            const futureDate = new Date(now.getTime() + 300000); // 5 minutes from now
            const repeatableJobs = [
                {
                    id: 'cron-workflow-1',
                    pattern: '0 9 * * *',
                    next: futureDate.getTime(),
                },
                {
                    id: 'other-job',
                    pattern: '*/5 * * * *',
                    next: futureDate.getTime(),
                },
            ];
            queueService.getRepeatableJobs.mockResolvedValue(repeatableJobs);
            const metrics = yield service.getCronDriftMetrics();
            expect(metrics).toHaveLength(1);
            expect(metrics[0]).toMatchObject({
                workflowId: 'workflow-1',
                schedule: '0 9 * * *',
                nextRun: futureDate,
            });
            expect(metrics[0].drift).toBeGreaterThan(0);
        }));
        it('should handle errors when getting drift metrics', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const error = new Error('Redis connection failed');
            queueService.getRepeatableJobs.mockRejectedValue(error);
            const metrics = yield service.getCronDriftMetrics();
            expect(metrics).toEqual([]);
            expect(mockLogger.error).toHaveBeenCalledWith({ error }, 'Failed to get cron drift metrics');
        }));
    });
    describe('cron drift detection', () => {
        it('should detect significant drift in cron execution', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const now = new Date();
            const pastDate = new Date(now.getTime() - 600000); // 10 minutes ago (significant drift)
            const repeatableJobs = [
                {
                    id: 'cron-workflow-1',
                    pattern: '0 9 * * *',
                    next: pastDate.getTime(),
                },
            ];
            queueService.getRepeatableJobs.mockResolvedValue(repeatableJobs);
            const metrics = yield service.getCronDriftMetrics();
            expect(metrics[0].drift).toBeGreaterThanOrEqual(600000); // At least 10 minutes drift
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3ZhZGltL1Byb2plY3RzL1Zpc0FQSS9hcHBzL2JhY2tlbmQvc3JjL2Nyb24vY3Jvbi1zZWVkZXIuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLDZDQUFzRDtBQUN0RCwrREFBMEQ7QUFDMUQseURBQXdEO0FBQ3hELDBEQUFzRDtBQUN0RCw2Q0FBNkM7QUFDN0MsdURBQThEO0FBRTlELFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsSUFBSSxPQUEwQixDQUFDO0lBQy9CLElBQUksZUFBNkMsQ0FBQztJQUNsRCxJQUFJLFlBQXVDLENBQUM7SUFFNUMsTUFBTSxVQUFVLEdBQUc7UUFDakIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNoQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNoQixDQUFDO0lBRUYsTUFBTSxhQUFhLEdBQUc7UUFDcEI7WUFDRSxFQUFFLEVBQUUsWUFBWTtZQUNoQixJQUFJLEVBQUUscUJBQXFCO1lBQzNCLE9BQU8sRUFBRSxJQUFJO1lBQ2IsTUFBTSxFQUFFO2dCQUNOLFFBQVEsRUFBRTtvQkFDUjt3QkFDRSxJQUFJLEVBQUUsTUFBTTt3QkFDWixNQUFNLEVBQUU7NEJBQ04sUUFBUSxFQUFFLFdBQVcsRUFBRSxnQkFBZ0I7NEJBQ3ZDLFFBQVEsRUFBRSxrQkFBa0I7eUJBQzdCO3FCQUNGO2lCQUNGO2dCQUNELEtBQUssRUFBRSxFQUFFO2FBQ1Y7U0FDRjtRQUNEO1lBQ0UsRUFBRSxFQUFFLFlBQVk7WUFDaEIsSUFBSSxFQUFFLGVBQWU7WUFDckIsT0FBTyxFQUFFLElBQUk7WUFDYixNQUFNLEVBQUU7Z0JBQ04sUUFBUSxFQUFFO29CQUNSO3dCQUNFLElBQUksRUFBRSxNQUFNO3dCQUNaLE1BQU0sRUFBRTs0QkFDTixRQUFRLEVBQUUsWUFBWSxFQUFFLDRCQUE0Qjt5QkFDckQ7cUJBQ0Y7aUJBQ0Y7Z0JBQ0QsS0FBSyxF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R0FBUyxFQUFFO1lBQ2pFLE1BQU0sR0FBRyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7WUFDdkIsTUFBTSxRQUFRLEdBQUcsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMscUNBQXFDO1lBRXhGLE1BQU0sY0FBYyxHQUFHO2dCQUNyQjtvQkFDRSxFQUFFLEVBQUUsaUJBQWlCO29CQUNyQixPQUFPLEVBQUUsV0FBVztvQkFDcEIsSUFBSSxFQUFFLFFBQVEsQ0FBQyxPQUFPLEVBQUU7aUJBQ3pCO2FBQ0YsQ0FBQztZQUVGLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUVqRSxNQUFNLE9BQU8sR0FBRyxNQUFNLE9BQU8sQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1lBRXBELE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsc0JBQXNCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyw0QkFBNEI7UUFDdkYsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3ZhZGltL1Byb2plY3RzL1Zpc0FQSS9hcHBzL2JhY2tlbmQvc3JjL2Nyb24vY3Jvbi1zZWVkZXIuc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgQ3JvblNlZWRlclNlcnZpY2UgfSBmcm9tICcuL2Nyb24tc2VlZGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgU3VwYWJhc2VTZXJ2aWNlIH0gZnJvbSAnQHZpc2FwaS9jb3JlLXN1cGFiYXNlJztcbmltcG9ydCB7IFF1ZXVlU2VydmljZSB9IGZyb20gJy4uL3F1ZXVlL3F1ZXVlLnNlcnZpY2UnO1xuaW1wb3J0IHsgZ2V0TG9nZ2VyVG9rZW4gfSBmcm9tICduZXN0anMtcGlubyc7XG5pbXBvcnQgeyBRVUVVRV9OQU1FUywgSk9CX05BTUVTIH0gZnJvbSAnQHZpc2FwaS9zaGFyZWQtdHlwZXMnO1xuXG5kZXNjcmliZSgnQ3JvblNlZWRlclNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBzZXJ2aWNlOiBDcm9uU2VlZGVyU2VydmljZTtcbiAgbGV0IHN1cGFiYXNlU2VydmljZTogamVzdC5Nb2NrZWQ8U3VwYWJhc2VTZXJ2aWNlPjtcbiAgbGV0IHF1ZXVlU2VydmljZTogamVzdC5Nb2NrZWQ8UXVldWVTZXJ2aWNlPjtcblxuICBjb25zdCBtb2NrTG9nZ2VyID0ge1xuICAgIGluZm86IGplc3QuZm4oKSxcbiAgICBlcnJvcjogamVzdC5mbigpLFxuICAgIHdhcm46IGplc3QuZm4oKSxcbiAgfTtcblxuICBjb25zdCBtb2NrV29ya2Zsb3dzID0gW1xuICAgIHtcbiAgICAgIGlkOiAnd29ya2Zsb3ctMScsXG4gICAgICBuYW1lOiAnRGFpbHkgU3RhdHVzIFVwZGF0ZScsXG4gICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgc2NoZW1hOiB7XG4gICAgICAgIHRyaWdnZXJzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogJ2Nyb24nLFxuICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgIHNjaGVkdWxlOiAnMCA5ICogKiAqJywgLy8gRGFpbHkgYXQgOSBBTVxuICAgICAgICAgICAgICB0aW1lem9uZTogJ0FtZXJpY2EvTmV3X1lvcmsnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICBzdGVwczogW10sXG4gICAgICB9LFxuICAgIH0sXG4gICAge1xuICAgICAgaWQ6ICd3b3JrZmxvdy0yJyxcbiAgICAgIG5hbWU6ICdXZWVrbHkgUmVwb3J0JyxcbiAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICBzY2hlbWE6IHtcbiAgICAgICAgdHJpZ2dlcnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAnY3JvbicsXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgc2NoZWR1bGU6ICcwIDEwICogKiAxJywgLy8gV2Vla2x5IG9uIE1vbmRheSBhdCAxMCBBTVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICBzdGVwczogW10sXG4gICAgICB9LFxuICAgIH0sXG4gICAge1xuICAgICAgaWQ6ICd3b3JrZmxvdy0zJyxcbiAgICAgIG5hbWU6ICdXZWJob29rIE9ubHknLFxuICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgIHNjaGVtYToge1xuICAgICAgICB0cmlnZ2VyczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6ICd3ZWJob29rJyxcbiAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICBlbmRwb2ludDogJy93ZWJob29rL3Rlc3QnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICBzdGVwczogW10sXG4gICAgICB9LFxuICAgIH0sXG4gIF07XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICBDcm9uU2VlZGVyU2VydmljZSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IGdldExvZ2dlclRva2VuKENyb25TZWVkZXJTZXJ2aWNlLm5hbWUpLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrTG9nZ2VyLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogU3VwYWJhc2VTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICBjbGllbnQ6IHtcbiAgICAgICAgICAgICAgZnJvbTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogUXVldWVTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICBhZGRSZXBlYXRhYmxlSm9iOiBqZXN0LmZuKCksXG4gICAgICAgICAgICByZW1vdmVSZXBlYXRhYmxlSm9iOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBnZXRSZXBlYXRhYmxlSm9iczogamVzdC5mbigpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PENyb25TZWVkZXJTZXJ2aWNlPihDcm9uU2VlZGVyU2VydmljZSk7XG4gICAgc3VwYWJhc2VTZXJ2aWNlID0gbW9kdWxlLmdldChTdXBhYmFzZVNlcnZpY2UpO1xuICAgIHF1ZXVlU2VydmljZSA9IG1vZHVsZS5nZXQoUXVldWVTZXJ2aWNlKTtcblxuICAgIC8vIFJlc2V0IG1vY2tzXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgYmUgZGVmaW5lZCcsICgpID0+IHtcbiAgICBleHBlY3Qoc2VydmljZSkudG9CZURlZmluZWQoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ29uTW9kdWxlSW5pdCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNlZWQgY3JvbiBqb2JzIG9uIG1vZHVsZSBpbml0aWFsaXphdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tGcm9tID0ge1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgZGF0YTogbW9ja1dvcmtmbG93cyxcbiAgICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KSxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIHN1cGFiYXNlU2VydmljZS5jbGllbnQuZnJvbSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobW9ja0Zyb20pO1xuICAgICAgcXVldWVTZXJ2aWNlLmdldFJlcGVhdGFibGVKb2JzLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcblxuICAgICAgYXdhaXQgc2VydmljZS5vbk1vZHVsZUluaXQoKTtcblxuICAgICAgZXhwZWN0KG1vY2tMb2dnZXIuaW5mbykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1N0YXJ0aW5nIGNyb24gam9iIHNlZWRpbmcnKTtcbiAgICAgIGV4cGVjdChxdWV1ZVNlcnZpY2UuYWRkUmVwZWF0YWJsZUpvYikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDMpOyAvLyAyIHdvcmtmbG93IGpvYnMgKyAxIGxvZyBwcnVuaW5nIGpvYlxuICAgICAgZXhwZWN0KG1vY2tMb2dnZXIuaW5mbykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdDcm9uIGpvYiBzZWVkaW5nIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5vIHdvcmtmbG93cyB3aXRoIGNyb24gdHJpZ2dlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRnJvbSA9IHtcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgIGRhdGE6IFttb2NrV29ya2Zsb3dzWzJdXSwgLy8gT25seSB3ZWJob29rIHdvcmtmbG93XG4gICAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gICAgICB9O1xuICAgICAgXG4gICAgICBzdXBhYmFzZVNlcnZpY2UuY2xpZW50LmZyb20gPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tGcm9tKTtcblxuICAgICAgYXdhaXQgc2VydmljZS5vbk1vZHVsZUluaXQoKTtcblxuICAgICAgZXhwZWN0KG1vY2tMb2dnZXIuaW5mbykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdObyB3b3JrZmxvd3Mgd2l0aCBjcm9uIHRyaWdnZXJzIGZvdW5kJyxcbiAgICAgICk7XG4gICAgICBleHBlY3QocXVldWVTZXJ2aWNlLmFkZFJlcGVhdGFibGVKb2IpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTsgLy8gT25seSBsb2cgcHJ1bmluZyBqb2JcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgICAgY29uc3QgbW9ja0Zyb20gPSB7XG4gICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB9LFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KSxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIHN1cGFiYXNlU2VydmljZS5jbGllbnQuZnJvbSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobW9ja0Zyb20pO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5vbk1vZHVsZUluaXQoKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnRmFpbGVkIHRvIGZldGNoIHdvcmtmbG93czogRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NlZWRDcm9uSm9icycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNjaGVkdWxlIHdvcmtmbG93cyB3aXRoIGNyb24gdHJpZ2dlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRnJvbSA9IHtcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgIGRhdGE6IG1vY2tXb3JrZmxvd3MsXG4gICAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gICAgICB9O1xuICAgICAgXG4gICAgICBzdXBhYmFzZVNlcnZpY2UuY2xpZW50LmZyb20gPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tGcm9tKTtcbiAgICAgIHF1ZXVlU2VydmljZS5nZXRSZXBlYXRhYmxlSm9icy5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2VlZENyb25Kb2JzKCk7XG5cbiAgICAgIGV4cGVjdChxdWV1ZVNlcnZpY2UuYWRkUmVwZWF0YWJsZUpvYikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIFFVRVVFX05BTUVTLkRFRkFVTFQsXG4gICAgICAgIEpPQl9OQU1FUy5QUk9DRVNTX1dPUktGTE9XLFxuICAgICAgICB7XG4gICAgICAgICAgd29ya2Zsb3dJZDogJ3dvcmtmbG93LTEnLFxuICAgICAgICAgIHRyaWdnZXI6IHtcbiAgICAgICAgICAgIHR5cGU6ICdjcm9uJyxcbiAgICAgICAgICAgIHNjaGVkdWxlOiAnMCA5ICogKiAqJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICB3b3JrZmxvd05hbWU6ICdEYWlseSBTdGF0dXMgVXBkYXRlJyxcbiAgICAgICAgICAgIHNjaGVkdWxlZEJ5OiAnY3Jvbi1zZWVkZXInLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwYXR0ZXJuOiAnMCA5ICogKiAqJyxcbiAgICAgICAgICB0ejogJ0FtZXJpY2EvTmV3X1lvcmsnLFxuICAgICAgICB9LFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHF1ZXVlU2VydmljZS5hZGRSZXBlYXRhYmxlSm9iKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgUVVFVUVfTkFNRVMuREVGQVVMVCxcbiAgICAgICAgSk9CX05BTUVTLlBST0NFU1NfV09SS0ZMT1csXG4gICAgICAgIHtcbiAgICAgICAgICB3b3JrZmxvd0lkOiAnd29ya2Zsb3ctMicsXG4gICAgICAgICAgdHJpZ2dlcjoge1xuICAgICAgICAgICAgdHlwZTogJ2Nyb24nLFxuICAgICAgICAgICAgc2NoZWR1bGU6ICcwIDEwICogKiAxJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICB3b3JrZmxvd05hbWU6ICdXZWVrbHkgUmVwb3J0JyxcbiAgICAgICAgICAgIHNjaGVkdWxlZEJ5OiAnY3Jvbi1zZWVkZXInLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwYXR0ZXJuOiAnMCAxMCAqICogMScsXG4gICAgICAgICAgdHo6ICdVVEMnLFxuICAgICAgICB9LFxuICAgICAgKTtcblxuICAgICAgLy8gVmVyaWZ5IGxvZyBwcnVuaW5nIGpvYiBpcyBzY2hlZHVsZWRcbiAgICAgIGV4cGVjdChxdWV1ZVNlcnZpY2UuYWRkUmVwZWF0YWJsZUpvYikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIFFVRVVFX05BTUVTLkRFRkFVTFQsXG4gICAgICAgIEpPQl9OQU1FUy5QUlVORV9MT0dTLFxuICAgICAgICB7XG4gICAgICAgICAgb2xkZXJUaGFuRGF5czogOTAsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwYXR0ZXJuOiAnMCAyICogKiAqJyxcbiAgICAgICAgICB0ejogJ1VUQycsXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjbGVhciBleGlzdGluZyBjcm9uIGpvYnMgYmVmb3JlIHNlZWRpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBleGlzdGluZ0pvYnMgPSBbXG4gICAgICAgIHsgaWQ6ICdjcm9uLXdvcmtmbG93LTEnLCBrZXk6ICdrZXkxJyB9LFxuICAgICAgICB7IGlkOiAnY3Jvbi13b3JrZmxvdy0yJywga2V5OiAna2V5MicgfSxcbiAgICAgICAgeyBpZDogJ2xvZy1wcnVuaW5nJywga2V5OiAna2V5MycgfSxcbiAgICAgICAgeyBpZDogJ290aGVyLWpvYicsIGtleTogJ2tleTQnIH0sXG4gICAgICBdO1xuXG4gICAgICBjb25zdCBtb2NrRnJvbSA9IHtcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgIGRhdGE6IG1vY2tXb3JrZmxvd3MsXG4gICAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gICAgICB9O1xuICAgICAgXG4gICAgICBzdXBhYmFzZVNlcnZpY2UuY2xpZW50LmZyb20gPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tGcm9tKTtcbiAgICAgIHF1ZXVlU2VydmljZS5nZXRSZXBlYXRhYmxlSm9icy5tb2NrUmVzb2x2ZWRWYWx1ZShleGlzdGluZ0pvYnMpO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnNlZWRDcm9uSm9icygpO1xuXG4gICAgICBleHBlY3QocXVldWVTZXJ2aWNlLnJlbW92ZVJlcGVhdGFibGVKb2IpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBRVUVVRV9OQU1FUy5ERUZBVUxULFxuICAgICAgICAnd29ya2Zsb3ctMScsXG4gICAgICApO1xuICAgICAgZXhwZWN0KHF1ZXVlU2VydmljZS5yZW1vdmVSZXBlYXRhYmxlSm9iKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgUVVFVUVfTkFNRVMuREVGQVVMVCxcbiAgICAgICAgJ3dvcmtmbG93LTInLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChxdWV1ZVNlcnZpY2UucmVtb3ZlUmVwZWF0YWJsZUpvYikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIFFVRVVFX05BTUVTLkRFRkFVTFQsXG4gICAgICAgICdsb2ctcHJ1bmluZycsXG4gICAgICApO1xuICAgICAgZXhwZWN0KHF1ZXVlU2VydmljZS5yZW1vdmVSZXBlYXRhYmxlSm9iKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd1cGRhdGVXb3JrZmxvd0Nyb25Kb2JzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdXBkYXRlIGNyb24gam9icyBmb3IgYW4gZW5hYmxlZCB3b3JrZmxvdycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZWRXb3JrZmxvdyA9IHtcbiAgICAgICAgLi4ubW9ja1dvcmtmbG93c1swXSxcbiAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgdHJpZ2dlcnM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdHlwZTogJ2Nyb24nLFxuICAgICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICBzY2hlZHVsZTogJzAgMTUgKiAqIConLCAvLyBVcGRhdGVkIHNjaGVkdWxlXG4gICAgICAgICAgICAgICAgdGltZXpvbmU6ICdVVEMnLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIHN0ZXBzOiBbXSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tGcm9tID0ge1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgICAgZGF0YTogdXBkYXRlZFdvcmtmbG93LFxuICAgICAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KSxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIHN1cGFiYXNlU2VydmljZS5jbGllbnQuZnJvbSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobW9ja0Zyb20pO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnVwZGF0ZVdvcmtmbG93Q3JvbkpvYnMoJ3dvcmtmbG93LTEnKTtcblxuICAgICAgZXhwZWN0KHF1ZXVlU2VydmljZS5yZW1vdmVSZXBlYXRhYmxlSm9iKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgUVVFVUVfTkFNRVMuREVGQVVMVCxcbiAgICAgICAgJ3dvcmtmbG93LTEnLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChxdWV1ZVNlcnZpY2UuYWRkUmVwZWF0YWJsZUpvYikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIFFVRVVFX05BTUVTLkRFRkFVTFQsXG4gICAgICAgIEpPQl9OQU1FUy5QUk9DRVNTX1dPUktGTE9XLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgd29ya2Zsb3dJZDogJ3dvcmtmbG93LTEnLFxuICAgICAgICB9KSxcbiAgICAgICAge1xuICAgICAgICAgIHBhdHRlcm46ICcwIDE1ICogKiAqJyxcbiAgICAgICAgICB0ejogJ1VUQycsXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgcmVzY2hlZHVsZSBkaXNhYmxlZCB3b3JrZmxvd3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkaXNhYmxlZFdvcmtmbG93ID0ge1xuICAgICAgICAuLi5tb2NrV29ya2Zsb3dzWzBdLFxuICAgICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tGcm9tID0ge1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgICAgZGF0YTogZGlzYWJsZWRXb3JrZmxvdyxcbiAgICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gICAgICB9O1xuICAgICAgXG4gICAgICBzdXBhYmFzZVNlcnZpY2UuY2xpZW50LmZyb20gPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tGcm9tKTtcblxuICAgICAgYXdhaXQgc2VydmljZS51cGRhdGVXb3JrZmxvd0Nyb25Kb2JzKCd3b3JrZmxvdy0xJyk7XG5cbiAgICAgIGV4cGVjdChxdWV1ZVNlcnZpY2UucmVtb3ZlUmVwZWF0YWJsZUpvYikudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KHF1ZXVlU2VydmljZS5hZGRSZXBlYXRhYmxlSm9iKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgd29ya2Zsb3cgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0Zyb20gPSB7XG4gICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgICAgICBlcnJvcjogeyBtZXNzYWdlOiAnTm90IGZvdW5kJyB9LFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pLFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgc3VwYWJhc2VTZXJ2aWNlLmNsaWVudC5mcm9tID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShtb2NrRnJvbSk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UudXBkYXRlV29ya2Zsb3dDcm9uSm9icygnbm9uLWV4aXN0ZW50Jyk7XG5cbiAgICAgIGV4cGVjdChtb2NrTG9nZ2VyLndhcm4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgd29ya2Zsb3dJZDogJ25vbi1leGlzdGVudCcsXG4gICAgICAgIH0pLFxuICAgICAgICAnV29ya2Zsb3cgbm90IGZvdW5kIGZvciBjcm9uIHVwZGF0ZScsXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVtb3ZlV29ya2Zsb3dDcm9uSm9icycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlbW92ZSBjcm9uIGpvYnMgZm9yIGEgd29ya2Zsb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzZXJ2aWNlLnJlbW92ZVdvcmtmbG93Q3JvbkpvYnMoJ3dvcmtmbG93LTEnKTtcblxuICAgICAgZXhwZWN0KHF1ZXVlU2VydmljZS5yZW1vdmVSZXBlYXRhYmxlSm9iKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgUVVFVUVfTkFNRVMuREVGQVVMVCxcbiAgICAgICAgJ3dvcmtmbG93LTEnLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChtb2NrTG9nZ2VyLmluZm8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB7IHdvcmtmbG93SWQ6ICd3b3JrZmxvdy0xJyB9LFxuICAgICAgICAnUmVtb3ZlZCBjcm9uIGpvYnMgZm9yIHdvcmtmbG93JyxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlcnJvcnMgd2hlbiByZW1vdmluZyBjcm9uIGpvYnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignRmFpbGVkIHRvIHJlbW92ZScpO1xuICAgICAgcXVldWVTZXJ2aWNlLnJlbW92ZVJlcGVhdGFibGVKb2IubW9ja1JlamVjdGVkVmFsdWUoZXJyb3IpO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnJlbW92ZVdvcmtmbG93Q3JvbkpvYnMoJ3dvcmtmbG93LTEnKTtcblxuICAgICAgZXhwZWN0KG1vY2tMb2dnZXIuZXJyb3IpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB7IGVycm9yLCB3b3JrZmxvd0lkOiAnd29ya2Zsb3ctMScgfSxcbiAgICAgICAgJ0ZhaWxlZCB0byByZW1vdmUgd29ya2Zsb3cgY3JvbiBqb2JzJyxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRDcm9uRHJpZnRNZXRyaWNzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGNyb24gZHJpZnQgbWV0cmljcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCBmdXR1cmVEYXRlID0gbmV3IERhdGUobm93LmdldFRpbWUoKSArIDMwMDAwMCk7IC8vIDUgbWludXRlcyBmcm9tIG5vd1xuXG4gICAgICBjb25zdCByZXBlYXRhYmxlSm9icyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnY3Jvbi13b3JrZmxvdy0xJyxcbiAgICAgICAgICBwYXR0ZXJuOiAnMCA5ICogKiAqJyxcbiAgICAgICAgICBuZXh0OiBmdXR1cmVEYXRlLmdldFRpbWUoKSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnb3RoZXItam9iJyxcbiAgICAgICAgICBwYXR0ZXJuOiAnKi81ICogKiAqIConLFxuICAgICAgICAgIG5leHQ6IGZ1dHVyZURhdGUuZ2V0VGltZSgpLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgcXVldWVTZXJ2aWNlLmdldFJlcGVhdGFibGVKb2JzLm1vY2tSZXNvbHZlZFZhbHVlKHJlcGVhdGFibGVKb2JzKTtcblxuICAgICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IHNlcnZpY2UuZ2V0Q3JvbkRyaWZ0TWV0cmljcygpO1xuXG4gICAgICBleHBlY3QobWV0cmljcykudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KG1ldHJpY3NbMF0pLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICB3b3JrZmxvd0lkOiAnd29ya2Zsb3ctMScsXG4gICAgICAgIHNjaGVkdWxlOiAnMCA5ICogKiAqJyxcbiAgICAgICAgbmV4dFJ1bjogZnV0dXJlRGF0ZSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KG1ldHJpY3NbMF0uZHJpZnQpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVycm9ycyB3aGVuIGdldHRpbmcgZHJpZnQgbWV0cmljcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdSZWRpcyBjb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgICAgcXVldWVTZXJ2aWNlLmdldFJlcGVhdGFibGVKb2JzLm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcblxuICAgICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IHNlcnZpY2UuZ2V0Q3JvbkRyaWZ0TWV0cmljcygpO1xuXG4gICAgICBleHBlY3QobWV0cmljcykudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QobW9ja0xvZ2dlci5lcnJvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIHsgZXJyb3IgfSxcbiAgICAgICAgJ0ZhaWxlZCB0byBnZXQgY3JvbiBkcmlmdCBtZXRyaWNzJyxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcm9uIGRyaWZ0IGRldGVjdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGRldGVjdCBzaWduaWZpY2FudCBkcmlmdCBpbiBjcm9uIGV4ZWN1dGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCBwYXN0RGF0ZSA9IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgLSA2MDAwMDApOyAvLyAxMCBtaW51dGVzIGFnbyAoc2lnbmlmaWNhbnQgZHJpZnQpXG5cbiAgICAgIGNvbnN0IHJlcGVhdGFibGVKb2JzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdjcm9uLXdvcmtmbG93LTEnLFxuICAgICAgICAgIHBhdHRlcm46ICcwIDkgKiAqIConLFxuICAgICAgICAgIG5leHQ6IHBhc3REYXRlLmdldFRpbWUoKSxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIHF1ZXVlU2VydmljZS5nZXRSZXBlYXRhYmxlSm9icy5tb2NrUmVzb2x2ZWRWYWx1ZShyZXBlYXRhYmxlSm9icyk7XG5cbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBhd2FpdCBzZXJ2aWNlLmdldENyb25EcmlmdE1ldHJpY3MoKTtcblxuICAgICAgZXhwZWN0KG1ldHJpY3NbMF0uZHJpZnQpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoNjAwMDAwKTsgLy8gQXQgbGVhc3QgMTAgbWludXRlcyBkcmlmdFxuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==