f94fd7ca8deddc07d4b90c5f9567316e
"use strict";
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", { value: true });
exports.MetricsService = void 0;
const tslib_1 = require("tslib");
const common_1 = require("@nestjs/common");
const nestjs_prometheus_1 = require("@willsoto/nestjs-prometheus");
const prom_client_1 = require("prom-client");
let MetricsService = class MetricsService {
    constructor(httpRequestDuration, httpRequestsTotal, httpActiveConnections, jobLatencySeconds, jobFailTotal, queueDepthTotal, webhookProcessedTotal, workflowExecutionDuration, apiKeyValidationDuration, redisOperationsTotal, redisOperationErrorsTotal) {
        this.httpRequestDuration = httpRequestDuration;
        this.httpRequestsTotal = httpRequestsTotal;
        this.httpActiveConnections = httpActiveConnections;
        this.jobLatencySeconds = jobLatencySeconds;
        this.jobFailTotal = jobFailTotal;
        this.queueDepthTotal = queueDepthTotal;
        this.webhookProcessedTotal = webhookProcessedTotal;
        this.workflowExecutionDuration = workflowExecutionDuration;
        this.apiKeyValidationDuration = apiKeyValidationDuration;
        this.redisOperationsTotal = redisOperationsTotal;
        this.redisOperationErrorsTotal = redisOperationErrorsTotal;
    }
    recordHttpRequest(method, route, statusCode, duration) {
        const labels = { method, route, status_code: statusCode.toString() };
        this.httpRequestDuration.observe(labels, duration / 1000); // Convert to seconds
        this.httpRequestsTotal.inc(labels);
    }
    incrementActiveConnections() {
        this.httpActiveConnections.inc();
    }
    decrementActiveConnections() {
        this.httpActiveConnections.dec();
    }
    recordJobExecution(jobName, queue, success, duration) {
        const labels = { job_name: jobName, queue, success: success.toString() };
        this.jobLatencySeconds.observe(labels, duration / 1000);
        if (!success) {
            this.jobFailTotal.inc({ job_name: jobName, queue });
        }
    }
    setQueueDepth(queue, priority, depth) {
        this.queueDepthTotal.set({ queue, priority }, depth);
    }
    incrementWebhookProcessed(status) {
        this.webhookProcessedTotal.inc({ status });
    }
    recordWorkflowExecution(workflowId, duration, success) {
        this.workflowExecutionDuration.observe({ workflow_id: workflowId, success: success.toString() }, duration / 1000);
    }
    recordApiKeyValidation(duration, valid) {
        this.apiKeyValidationDuration.observe({ valid: valid.toString() }, duration / 1000);
    }
    recordRedisOperation(operation, success) {
        this.redisOperationsTotal.inc({ operation, success: success.toString() });
        if (!success) {
            this.redisOperationErrorsTotal.inc({ operation });
        }
    }
};
exports.MetricsService = MetricsService;
exports.MetricsService = MetricsService = tslib_1.__decorate([
    (0, common_1.Injectable)(),
    tslib_1.__param(0, (0, nestjs_prometheus_1.InjectMetric)('http_request_duration_seconds')),
    tslib_1.__param(1, (0, nestjs_prometheus_1.InjectMetric)('http_requests_total')),
    tslib_1.__param(2, (0, nestjs_prometheus_1.InjectMetric)('http_active_connections')),
    tslib_1.__param(3, (0, nestjs_prometheus_1.InjectMetric)('job_latency_seconds')),
    tslib_1.__param(4, (0, nestjs_prometheus_1.InjectMetric)('job_fail_total')),
    tslib_1.__param(5, (0, nestjs_prometheus_1.InjectMetric)('queue_depth_total')),
    tslib_1.__param(6, (0, nestjs_prometheus_1.InjectMetric)('webhook_processed_total')),
    tslib_1.__param(7, (0, nestjs_prometheus_1.InjectMetric)('workflow_execution_duration_seconds')),
    tslib_1.__param(8, (0, nestjs_prometheus_1.InjectMetric)('api_key_validation_duration_seconds')),
    tslib_1.__param(9, (0, nestjs_prometheus_1.InjectMetric)('redis_operations_total')),
    tslib_1.__param(10, (0, nestjs_prometheus_1.InjectMetric)('redis_operation_errors_total')),
    tslib_1.__metadata("design:paramtypes", [typeof (_a = typeof prom_client_1.Histogram !== "undefined" && prom_client_1.Histogram) === "function" ? _a : Object, typeof (_b = typeof prom_client_1.Counter !== "undefined" && prom_client_1.Counter) === "function" ? _b : Object, typeof (_c = typeof prom_client_1.Gauge !== "undefined" && prom_client_1.Gauge) === "function" ? _c : Object, typeof (_d = typeof prom_client_1.Histogram !== "undefined" && prom_client_1.Histogram) === "function" ? _d : Object, typeof (_e = typeof prom_client_1.Counter !== "undefined" && prom_client_1.Counter) === "function" ? _e : Object, typeof (_f = typeof prom_client_1.Gauge !== "undefined" && prom_client_1.Gauge) === "function" ? _f : Object, typeof (_g = typeof prom_client_1.Counter !== "undefined" && prom_client_1.Counter) === "function" ? _g : Object, typeof (_h = typeof prom_client_1.Histogram !== "undefined" && prom_client_1.Histogram) === "function" ? _h : Object, typeof (_j = typeof prom_client_1.Histogram !== "undefined" && prom_client_1.Histogram) === "function" ? _j : Object, typeof (_k = typeof prom_client_1.Counter !== "undefined" && prom_client_1.Counter) === "function" ? _k : Object, typeof (_l = typeof prom_client_1.Counter !== "undefined" && prom_client_1.Counter) === "function" ? _l : Object])
], MetricsService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3ZhZGltL1Byb2plY3RzL1Zpc0FQSS9hcHBzL2JhY2tlbmQvc3JjL21ldHJpY3MvbWV0cmljcy5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsMkNBQTRDO0FBQzVDLG1FQUEyRDtBQUMzRCw2Q0FBd0Q7QUFHakQsSUFBTSxjQUFjLEdBQXBCLE1BQU0sY0FBYztJQUN6QixZQUVTLG1CQUFzQyxFQUd0QyxpQkFBa0MsRUFHbEMscUJBQW9DLEVBR3BDLGlCQUFvQyxFQUdwQyxZQUE2QixFQUc3QixlQUE4QixFQUc5QixxQkFBc0MsRUFHdEMseUJBQTRDLEVBRzVDLHdCQUEyQyxFQUczQyxvQkFBcUMsRUFHckMseUJBQTBDO1FBOUIxQyx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQW1CO1FBR3RDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBaUI7UUFHbEMsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUFlO1FBR3BDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFHcEMsaUJBQVksR0FBWixZQUFZLENBQWlCO1FBRzdCLG9CQUFlLEdBQWYsZUFBZSxDQUFlO1FBRzlCLDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBaUI7UUFHdEMsOEJBQXlCLEdBQXpCLHlCQUF5QixDQUFtQjtRQUc1Qyw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQW1CO1FBRzNDLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBaUI7UUFHckMsOEJBQXlCLEdBQXpCLHlCQUF5QixDQUFpQjtJQUNoRCxDQUFDO0lBRUosaUJBQWlCLENBQUMsTUFBYyxFQUFFLEtBQWEsRUFBRSxVQUFrQixFQUFFLFFBQWdCO1FBQ25GLE1BQU0sTUFBTSxHQUFHLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsVUFBVSxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUM7UUFFckUsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsUUFBUSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMscUJBQXFCO1FBQ2hG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LEVBQUMscUNBQXFDLENBQUMsQ0FBQTtJQUduRCxtQkFBQSxJQUFBLGdDQUFZLEVBQUMsd0JBQXdCLENBQUMsQ0FBQTtJQUd0QyxvQkFBQSxJQUFBLGdDQUFZLEVBQUMsOEJBQThCLENBQUMsQ0FBQTtpRUE3QmpCLHVCQUFTLG9CQUFULHVCQUFTLG9EQUdYLHFCQUFPLG9CQUFQLHFCQUFPLG9EQUdILG1CQUFLLG9CQUFMLG1CQUFLLG9EQUdULHVCQUFTLG9CQUFULHVCQUFTLG9EQUdkLHFCQUFPLG9CQUFQLHFCQUFPLG9EQUdKLG1CQUFLLG9CQUFMLG1CQUFLLG9EQUdDLHFCQUFPLG9CQUFQLHFCQUFPLG9EQUdILHVCQUFTLG9CQUFULHVCQUFTLG9EQUdWLHVCQUFTLG9CQUFULHVCQUFTLG9EQUdiLHFCQUFPLG9CQUFQLHFCQUFPLG9EQUdGLHFCQUFPLG9CQUFQLHFCQUFPO0dBakNoQyxjQUFjLENBK0YxQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvdmFkaW0vUHJvamVjdHMvVmlzQVBJL2FwcHMvYmFja2VuZC9zcmMvbWV0cmljcy9tZXRyaWNzLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IEluamVjdE1ldHJpYyB9IGZyb20gJ0B3aWxsc290by9uZXN0anMtcHJvbWV0aGV1cyc7XG5pbXBvcnQgeyBDb3VudGVyLCBIaXN0b2dyYW0sIEdhdWdlIH0gZnJvbSAncHJvbS1jbGllbnQnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTWV0cmljc1NlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBASW5qZWN0TWV0cmljKCdodHRwX3JlcXVlc3RfZHVyYXRpb25fc2Vjb25kcycpXG4gICAgcHVibGljIGh0dHBSZXF1ZXN0RHVyYXRpb246IEhpc3RvZ3JhbTxzdHJpbmc+LFxuICAgIFxuICAgIEBJbmplY3RNZXRyaWMoJ2h0dHBfcmVxdWVzdHNfdG90YWwnKVxuICAgIHB1YmxpYyBodHRwUmVxdWVzdHNUb3RhbDogQ291bnRlcjxzdHJpbmc+LFxuICAgIFxuICAgIEBJbmplY3RNZXRyaWMoJ2h0dHBfYWN0aXZlX2Nvbm5lY3Rpb25zJylcbiAgICBwdWJsaWMgaHR0cEFjdGl2ZUNvbm5lY3Rpb25zOiBHYXVnZTxzdHJpbmc+LFxuICAgIFxuICAgIEBJbmplY3RNZXRyaWMoJ2pvYl9sYXRlbmN5X3NlY29uZHMnKVxuICAgIHB1YmxpYyBqb2JMYXRlbmN5U2Vjb25kczogSGlzdG9ncmFtPHN0cmluZz4sXG4gICAgXG4gICAgQEluamVjdE1ldHJpYygnam9iX2ZhaWxfdG90YWwnKVxuICAgIHB1YmxpYyBqb2JGYWlsVG90YWw6IENvdW50ZXI8c3RyaW5nPixcbiAgICBcbiAgICBASW5qZWN0TWV0cmljKCdxdWV1ZV9kZXB0aF90b3RhbCcpXG4gICAgcHVibGljIHF1ZXVlRGVwdGhUb3RhbDogR2F1Z2U8c3RyaW5nPixcbiAgICBcbiAgICBASW5qZWN0TWV0cmljKCd3ZWJob29rX3Byb2Nlc3NlZF90b3RhbCcpXG4gICAgcHVibGljIHdlYmhvb2tQcm9jZXNzZWRUb3RhbDogQ291bnRlcjxzdHJpbmc+LFxuICAgIFxuICAgIEBJbmplY3RNZXRyaWMoJ3dvcmtmbG93X2V4ZWN1dGlvbl9kdXJhdGlvbl9zZWNvbmRzJylcbiAgICBwdWJsaWMgd29ya2Zsb3dFeGVjdXRpb25EdXJhdGlvbjogSGlzdG9ncmFtPHN0cmluZz4sXG4gICAgXG4gICAgQEluamVjdE1ldHJpYygnYXBpX2tleV92YWxpZGF0aW9uX2R1cmF0aW9uX3NlY29uZHMnKVxuICAgIHB1YmxpYyBhcGlLZXlWYWxpZGF0aW9uRHVyYXRpb246IEhpc3RvZ3JhbTxzdHJpbmc+LFxuICAgIFxuICAgIEBJbmplY3RNZXRyaWMoJ3JlZGlzX29wZXJhdGlvbnNfdG90YWwnKVxuICAgIHB1YmxpYyByZWRpc09wZXJhdGlvbnNUb3RhbDogQ291bnRlcjxzdHJpbmc+LFxuICAgIFxuICAgIEBJbmplY3RNZXRyaWMoJ3JlZGlzX29wZXJhdGlvbl9lcnJvcnNfdG90YWwnKVxuICAgIHB1YmxpYyByZWRpc09wZXJhdGlvbkVycm9yc1RvdGFsOiBDb3VudGVyPHN0cmluZz4sXG4gICkge31cblxuICByZWNvcmRIdHRwUmVxdWVzdChtZXRob2Q6IHN0cmluZywgcm91dGU6IHN0cmluZywgc3RhdHVzQ29kZTogbnVtYmVyLCBkdXJhdGlvbjogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3QgbGFiZWxzID0geyBtZXRob2QsIHJvdXRlLCBzdGF0dXNfY29kZTogc3RhdHVzQ29kZS50b1N0cmluZygpIH07XG4gICAgXG4gICAgdGhpcy5odHRwUmVxdWVzdER1cmF0aW9uLm9ic2VydmUobGFiZWxzLCBkdXJhdGlvbiAvIDEwMDApOyAvLyBDb252ZXJ0IHRvIHNlY29uZHNcbiAgICB0aGlzLmh0dHBSZXF1ZXN0c1RvdGFsLmluYyhsYWJlbHMpO1xuICB9XG5cbiAgaW5jcmVtZW50QWN0aXZlQ29ubmVjdGlvbnMoKTogdm9pZCB7XG4gICAgdGhpcy5odHRwQWN0aXZlQ29ubmVjdGlvbnMuaW5jKCk7XG4gIH1cblxuICBkZWNyZW1lbnRBY3RpdmVDb25uZWN0aW9ucygpOiB2b2lkIHtcbiAgICB0aGlzLmh0dHBBY3RpdmVDb25uZWN0aW9ucy5kZWMoKTtcbiAgfVxuXG4gIHJlY29yZEpvYkV4ZWN1dGlvbihcbiAgICBqb2JOYW1lOiBzdHJpbmcsXG4gICAgcXVldWU6IHN0cmluZyxcbiAgICBzdWNjZXNzOiBib29sZWFuLFxuICAgIGR1cmF0aW9uOiBudW1iZXIsXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IGxhYmVscyA9IHsgam9iX25hbWU6IGpvYk5hbWUsIHF1ZXVlLCBzdWNjZXNzOiBzdWNjZXNzLnRvU3RyaW5nKCkgfTtcbiAgICBcbiAgICB0aGlzLmpvYkxhdGVuY3lTZWNvbmRzLm9ic2VydmUobGFiZWxzLCBkdXJhdGlvbiAvIDEwMDApO1xuICAgIFxuICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgdGhpcy5qb2JGYWlsVG90YWwuaW5jKHsgam9iX25hbWU6IGpvYk5hbWUsIHF1ZXVlIH0pO1xuICAgIH1cbiAgfVxuXG4gIHNldFF1ZXVlRGVwdGgocXVldWU6IHN0cmluZywgcHJpb3JpdHk6IHN0cmluZywgZGVwdGg6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMucXVldWVEZXB0aFRvdGFsLnNldCh7IHF1ZXVlLCBwcmlvcml0eSB9LCBkZXB0aCk7XG4gIH1cblxuICBpbmNyZW1lbnRXZWJob29rUHJvY2Vzc2VkKHN0YXR1czogJ3N1Y2Nlc3MnIHwgJ2ZhaWx1cmUnKTogdm9pZCB7XG4gICAgdGhpcy53ZWJob29rUHJvY2Vzc2VkVG90YWwuaW5jKHsgc3RhdHVzIH0pO1xuICB9XG5cbiAgcmVjb3JkV29ya2Zsb3dFeGVjdXRpb24od29ya2Zsb3dJZDogc3RyaW5nLCBkdXJhdGlvbjogbnVtYmVyLCBzdWNjZXNzOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy53b3JrZmxvd0V4ZWN1dGlvbkR1cmF0aW9uLm9ic2VydmUoXG4gICAgICB7IHdvcmtmbG93X2lkOiB3b3JrZmxvd0lkLCBzdWNjZXNzOiBzdWNjZXNzLnRvU3RyaW5nKCkgfSxcbiAgICAgIGR1cmF0aW9uIC8gMTAwMCxcbiAgICApO1xuICB9XG5cbiAgcmVjb3JkQXBpS2V5VmFsaWRhdGlvbihkdXJhdGlvbjogbnVtYmVyLCB2YWxpZDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuYXBpS2V5VmFsaWRhdGlvbkR1cmF0aW9uLm9ic2VydmUoXG4gICAgICB7IHZhbGlkOiB2YWxpZC50b1N0cmluZygpIH0sXG4gICAgICBkdXJhdGlvbiAvIDEwMDAsXG4gICAgKTtcbiAgfVxuXG4gIHJlY29yZFJlZGlzT3BlcmF0aW9uKG9wZXJhdGlvbjogc3RyaW5nLCBzdWNjZXNzOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5yZWRpc09wZXJhdGlvbnNUb3RhbC5pbmMoeyBvcGVyYXRpb24sIHN1Y2Nlc3M6IHN1Y2Nlc3MudG9TdHJpbmcoKSB9KTtcbiAgICBcbiAgICBpZiAoIXN1Y2Nlc3MpIHtcbiAgICAgIHRoaXMucmVkaXNPcGVyYXRpb25FcnJvcnNUb3RhbC5pbmMoeyBvcGVyYXRpb24gfSk7XG4gICAgfVxuICB9XG59Il0sInZlcnNpb24iOjN9