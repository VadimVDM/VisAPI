65869304e70f9d328a595cfb793df8ac
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const testing_1 = require("@nestjs/testing");
const pii_redaction_service_1 = require("./pii-redaction.service");
describe('PiiRedactionService', () => {
    let service;
    beforeEach(() => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
        const module = yield testing_1.Test.createTestingModule({
            providers: [pii_redaction_service_1.PiiRedactionService],
        }).compile();
        service = module.get(pii_redaction_service_1.PiiRedactionService);
    }));
    describe('redactPii', () => {
        it('should redact phone numbers', () => {
            const testCases = [
                '+1234567890',
                '123-456-7890',
                '(123) 456-7890',
                '123.456.7890',
                '1234567890',
            ];
            testCases.forEach(phone => {
                const result = service.redactPii(`Call me at ${phone}`);
                expect(result.text).toBe('Call me at [PHONE_REDACTED]');
                expect(result.piiFound).toBe(true);
                expect(result.redactedFields).toContain('phone_number');
            });
        });
        it('should redact email addresses', () => {
            const testCases = [
                'user@example.com',
                'test.email+tag@domain.co.uk',
                'user123@test-domain.org',
            ];
            testCases.forEach(email => {
                const result = service.redactPii(`Contact us at ${email}`);
                expect(result.text).toBe('Contact us at [EMAIL_REDACTED]');
                expect(result.piiFound).toBe(true);
                expect(result.redactedFields).toContain('email');
            });
        });
        it('should redact credit card numbers', () => {
            const testCases = [
                '1234 5678 9012 3456',
                '1234-5678-9012-3456',
                '1234.5678.9012.3456',
                '1234567890123456',
            ];
            testCases.forEach(card => {
                const result = service.redactPii(`Card: ${card}`);
                expect(result.text).toBe('Card: [CARD_REDACTED]');
                expect(result.piiFound).toBe(true);
                expect(result.redactedFields).toContain('credit_card');
            });
        });
        it('should redact SSN numbers', () => {
            const testCases = [
                '123-45-6789',
                '123456789',
            ];
            testCases.forEach(ssn => {
                const result = service.redactPii(`SSN: ${ssn}`);
                expect(result.text).toBe('SSN: [SSN_REDACTED]');
                expect(result.piiFound).toBe(true);
                expect(result.redactedFields).toContain('ssn');
            });
        });
        it('should redact IP addresses', () => {
            const testCases = [
                '192.168.1.1',
                '10.0.0.1',
                '172.16.0.1',
            ];
            testCases.forEach(ip => {
                const result = service.redactPii(`Server IP: ${ip}`);
                expect(result.text).toBe('Server IP: [IP_REDACTED]');
                expect(result.piiFound).toBe(true);
                expect(result.redactedFields).toContain('ip_address');
            });
        });
        it('should redact multiple PII types in one text', () => {
            const text = 'Contact John at john@example.com or call +1234567890. IP: 192.168.1.1';
            const result = service.redactPii(text);
            expect(result.text).toBe('Contact John at [EMAIL_REDACTED] or call [PHONE_REDACTED]. IP: [IP_REDACTED]');
            expect(result.piiFound).toBe(true);
            expect(result.redactedFields).toContain('email');
            expect(result.redactedFields).toContain('phone_number');
            expect(result.redactedFields).toContain('ip_address');
        });
        it('should handle empty or null input', () => {
            expect(service.redactPii('')).toEqual({
                text: '',
                piiFound: false,
                redactedFields: [],
            });
            expect(service.redactPii(null)).toEqual({
                text: '',
                piiFound: false,
                redactedFields: [],
            });
            expect(service.redactPii(undefined)).toEqual({
                text: '',
                piiFound: false,
                redactedFields: [],
            });
        });
        it('should handle non-string input', () => {
            const result = service.redactPii(123);
            expect(result.text).toBe('');
            expect(result.piiFound).toBe(false);
        });
        it('should not modify text without PII', () => {
            const text = 'This is a normal message without sensitive data';
            const result = service.redactPii(text);
            expect(result.text).toBe(text);
            expect(result.piiFound).toBe(false);
            expect(result.redactedFields).toEqual([]);
        });
    });
    describe('redactPiiFromObject', () => {
        it('should redact PII from object properties', () => {
            const obj = {
                name: 'John Doe',
                email: 'john@example.com',
                phone: '+1234567890',
                metadata: {
                    ip: '192.168.1.1',
                    notes: 'Contact at jane@test.com',
                },
            };
            const result = service.redactPiiFromObject(obj);
            expect(result.obj.name).toBe('John Doe');
            expect(result.obj.email).toBe('[EMAIL_REDACTED]');
            expect(result.obj.phone).toBe('[PHONE_REDACTED]');
            expect(result.obj.metadata.ip).toBe('[IP_REDACTED]');
            expect(result.obj.metadata.notes).toBe('Contact at [EMAIL_REDACTED]');
            expect(result.piiFound).toBe(true);
            expect(result.redactedFields).toContain('email');
            expect(result.redactedFields).toContain('phone_number');
            expect(result.redactedFields).toContain('ip_address');
        });
        it('should handle arrays', () => {
            const arr = [
                'john@example.com',
                '+1234567890',
                'normal text',
            ];
            const result = service.redactPiiFromObject(arr);
            expect(result.obj[0]).toBe('[EMAIL_REDACTED]');
            expect(result.obj[1]).toBe('[PHONE_REDACTED]');
            expect(result.obj[2]).toBe('normal text');
            expect(result.piiFound).toBe(true);
        });
        it('should handle nested objects', () => {
            const obj = {
                level1: {
                    level2: {
                        level3: {
                            email: 'deep@example.com',
                        },
                    },
                },
            };
            const result = service.redactPiiFromObject(obj);
            expect(result.obj.level1.level2.level3.email).toBe('[EMAIL_REDACTED]');
            expect(result.piiFound).toBe(true);
        });
        it('should handle non-object input', () => {
            const result = service.redactPiiFromObject('test@example.com');
            expect(result.obj).toBe('[EMAIL_REDACTED]');
            expect(result.piiFound).toBe(true);
        });
        it('should handle null and undefined', () => {
            expect(service.redactPiiFromObject(null).obj).toBe(null);
            expect(service.redactPiiFromObject(undefined).obj).toBe(undefined);
        });
    });
    describe('containsPii', () => {
        it('should detect PII presence', () => {
            expect(service.containsPii('Contact: john@example.com')).toBe(true);
            expect(service.containsPii('Call +1234567890')).toBe(true);
            expect(service.containsPii('Normal text')).toBe(false);
            expect(service.containsPii('')).toBe(false);
            expect(service.containsPii(null)).toBe(false);
        });
    });
    describe('getPiiStats', () => {
        it('should return PII statistics', () => {
            const text = 'Contact john@example.com or jane@test.com, call +1234567890 or +0987654321';
            const stats = service.getPiiStats(text);
            expect(stats.email).toBe(2);
            expect(stats.phone_number).toBe(2);
            expect(stats.credit_card).toBe(0);
            expect(stats.ssn).toBe(0);
        });
        it('should handle empty text', () => {
            const stats = service.getPiiStats('');
            expect(Object.values(stats).every(count => count === 0)).toBe(true);
        });
    });
    describe('pattern management', () => {
        it('should allow adding custom patterns', () => {
            const customRegex = /CUSTOM-\d{4}/g;
            service.addPattern('custom', customRegex, '[CUSTOM_REDACTED]');
            const result = service.redactPii('Code: CUSTOM-1234');
            expect(result.text).toBe('Code: [CUSTOM_REDACTED]');
            expect(result.piiFound).toBe(true);
        });
        it('should allow removing patterns', () => {
            service.removePattern('email');
            const result = service.redactPii('Contact: john@example.com');
            expect(result.text).toBe('Contact: john@example.com');
            expect(result.piiFound).toBe(false);
        });
        it('should return all patterns', () => {
            const patterns = service.getPatterns();
            expect(patterns).toHaveProperty('email');
            expect(patterns).toHaveProperty('phone');
            expect(patterns).toHaveProperty('creditCard');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3ZhZGltL1Byb2plY3RzL1Zpc0FQSS9hcHBzL2JhY2tlbmQvc3JjL2xvZ3Mvc2VydmljZXMvcGlpLXJlZGFjdGlvbi5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkNBQXNEO0FBQ3RELG1FQUE4RDtBQUU5RCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBQ25DLElBQUksT0FBNEIsQ0FBQztJQUVqQyxVQUFVLENBQUMsR0FBUyxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUUsQ0FBQywyQ0FBbUIsQ0FBQztTQUNqQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBc0IsMkNBQW1CLENBQUMsQ0FBQztJQUNqRSxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7UUFDekIsRUFBRSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtZQUNyQyxNQUFNLFNBQVMsR0FBRztnQkFDaEIsYUFBYTtnQkFDYixjQUFjO2dCQUNkLGdCQUFnQjtnQkFDaEIsY0FBYztnQkFDZCxZQUFZO2FBQ2IsQ0FBQztZQUVGLFNBQVMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQ3hCLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsY0FBYyxLQUFLLEVBQUUsQ0FBQyxDQUFDO2dCQUN4RCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO2dCQUN4RCxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDbkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUM7WUFDMUQsQ0FB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c291cmNlcyI6WyIvVXNlcnMvdmFkaW0vUHJvamVjdHMvVmlzQVBJL2FwcHMvYmFja2VuZC9zcmMvbG9ncy9zZXJ2aWNlcy9waWktcmVkYWN0aW9uLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IFBpaVJlZGFjdGlvblNlcnZpY2UgfSBmcm9tICcuL3BpaS1yZWRhY3Rpb24uc2VydmljZSc7XG5cbmRlc2NyaWJlKCdQaWlSZWRhY3Rpb25TZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogUGlpUmVkYWN0aW9uU2VydmljZTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbUGlpUmVkYWN0aW9uU2VydmljZV0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8UGlpUmVkYWN0aW9uU2VydmljZT4oUGlpUmVkYWN0aW9uU2VydmljZSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZWRhY3RQaWknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZWRhY3QgcGhvbmUgbnVtYmVycycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RDYXNlcyA9IFtcbiAgICAgICAgJysxMjM0NTY3ODkwJyxcbiAgICAgICAgJzEyMy00NTYtNzg5MCcsXG4gICAgICAgICcoMTIzKSA0NTYtNzg5MCcsXG4gICAgICAgICcxMjMuNDU2Ljc4OTAnLFxuICAgICAgICAnMTIzNDU2Nzg5MCcsXG4gICAgICBdO1xuXG4gICAgICB0ZXN0Q2FzZXMuZm9yRWFjaChwaG9uZSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHNlcnZpY2UucmVkYWN0UGlpKGBDYWxsIG1lIGF0ICR7cGhvbmV9YCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQudGV4dCkudG9CZSgnQ2FsbCBtZSBhdCBbUEhPTkVfUkVEQUNURURdJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQucGlpRm91bmQpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQucmVkYWN0ZWRGaWVsZHMpLnRvQ29udGFpbigncGhvbmVfbnVtYmVyJyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVkYWN0IGVtYWlsIGFkZHJlc3NlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RDYXNlcyA9IFtcbiAgICAgICAgJ3VzZXJAZXhhbXBsZS5jb20nLFxuICAgICAgICAndGVzdC5lbWFpbCt0YWdAZG9tYWluLmNvLnVrJyxcbiAgICAgICAgJ3VzZXIxMjNAdGVzdC1kb21haW4ub3JnJyxcbiAgICAgIF07XG5cbiAgICAgIHRlc3RDYXNlcy5mb3JFYWNoKGVtYWlsID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS5yZWRhY3RQaWkoYENvbnRhY3QgdXMgYXQgJHtlbWFpbH1gKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC50ZXh0KS50b0JlKCdDb250YWN0IHVzIGF0IFtFTUFJTF9SRURBQ1RFRF0nKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5waWlGb3VuZCkudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5yZWRhY3RlZEZpZWxkcykudG9Db250YWluKCdlbWFpbCcpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlZGFjdCBjcmVkaXQgY2FyZCBudW1iZXJzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdENhc2VzID0gW1xuICAgICAgICAnMTIzNCA1Njc4IDkwMTIgMzQ1NicsXG4gICAgICAgICcxMjM0LTU2NzgtOTAxMi0zNDU2JyxcbiAgICAgICAgJzEyMzQuNTY3OC45MDEyLjM0NTYnLFxuICAgICAgICAnMTIzNDU2Nzg5MDEyMzQ1NicsXG4gICAgICBdO1xuXG4gICAgICB0ZXN0Q2FzZXMuZm9yRWFjaChjYXJkID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS5yZWRhY3RQaWkoYENhcmQ6ICR7Y2FyZH1gKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC50ZXh0KS50b0JlKCdDYXJkOiBbQ0FSRF9SRURBQ1RFRF0nKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5waWlGb3VuZCkudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5yZWRhY3RlZEZpZWxkcykudG9Db250YWluKCdjcmVkaXRfY2FyZCcpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlZGFjdCBTU04gbnVtYmVycycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RDYXNlcyA9IFtcbiAgICAgICAgJzEyMy00NS02Nzg5JyxcbiAgICAgICAgJzEyMzQ1Njc4OScsXG4gICAgICBdO1xuXG4gICAgICB0ZXN0Q2FzZXMuZm9yRWFjaChzc24gPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBzZXJ2aWNlLnJlZGFjdFBpaShgU1NOOiAke3Nzbn1gKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC50ZXh0KS50b0JlKCdTU046IFtTU05fUkVEQUNURURdJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQucGlpRm91bmQpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQucmVkYWN0ZWRGaWVsZHMpLnRvQ29udGFpbignc3NuJyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVkYWN0IElQIGFkZHJlc3NlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RDYXNlcyA9IFtcbiAgICAgICAgJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgJzEwLjAuMC4xJyxcbiAgICAgICAgJzE3Mi4xNi4wLjEnLFxuICAgICAgXTtcblxuICAgICAgdGVzdENhc2VzLmZvckVhY2goaXAgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBzZXJ2aWNlLnJlZGFjdFBpaShgU2VydmVyIElQOiAke2lwfWApO1xuICAgICAgICBleHBlY3QocmVzdWx0LnRleHQpLnRvQmUoJ1NlcnZlciBJUDogW0lQX1JFREFDVEVEXScpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnBpaUZvdW5kKS50b0JlKHRydWUpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnJlZGFjdGVkRmllbGRzKS50b0NvbnRhaW4oJ2lwX2FkZHJlc3MnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWRhY3QgbXVsdGlwbGUgUElJIHR5cGVzIGluIG9uZSB0ZXh0JywgKCkgPT4ge1xuICAgICAgY29uc3QgdGV4dCA9ICdDb250YWN0IEpvaG4gYXQgam9obkBleGFtcGxlLmNvbSBvciBjYWxsICsxMjM0NTY3ODkwLiBJUDogMTkyLjE2OC4xLjEnO1xuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS5yZWRhY3RQaWkodGV4dCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQudGV4dCkudG9CZSgnQ29udGFjdCBKb2huIGF0IFtFTUFJTF9SRURBQ1RFRF0gb3IgY2FsbCBbUEhPTkVfUkVEQUNURURdLiBJUDogW0lQX1JFREFDVEVEXScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5waWlGb3VuZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVkYWN0ZWRGaWVsZHMpLnRvQ29udGFpbignZW1haWwnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVkYWN0ZWRGaWVsZHMpLnRvQ29udGFpbigncGhvbmVfbnVtYmVyJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlZGFjdGVkRmllbGRzKS50b0NvbnRhaW4oJ2lwX2FkZHJlc3MnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IG9yIG51bGwgaW5wdXQnLCAoKSA9PiB7XG4gICAgICBleHBlY3Qoc2VydmljZS5yZWRhY3RQaWkoJycpKS50b0VxdWFsKHtcbiAgICAgICAgdGV4dDogJycsXG4gICAgICAgIHBpaUZvdW5kOiBmYWxzZSxcbiAgICAgICAgcmVkYWN0ZWRGaWVsZHM6IFtdLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChzZXJ2aWNlLnJlZGFjdFBpaShudWxsIGFzIGFueSkpLnRvRXF1YWwoe1xuICAgICAgICB0ZXh0OiAnJyxcbiAgICAgICAgcGlpRm91bmQ6IGZhbHNlLFxuICAgICAgICByZWRhY3RlZEZpZWxkczogW10sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHNlcnZpY2UucmVkYWN0UGlpKHVuZGVmaW5lZCBhcyBhbnkpKS50b0VxdWFsKHtcbiAgICAgICAgdGV4dDogJycsXG4gICAgICAgIHBpaUZvdW5kOiBmYWxzZSxcbiAgICAgICAgcmVkYWN0ZWRGaWVsZHM6IFtdLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBub24tc3RyaW5nIGlucHV0JywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS5yZWRhY3RQaWkoMTIzIGFzIGFueSk7XG4gICAgICBleHBlY3QocmVzdWx0LnRleHQpLnRvQmUoJycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5waWlGb3VuZCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBtb2RpZnkgdGV4dCB3aXRob3V0IFBJSScsICgpID0+IHtcbiAgICAgIGNvbnN0IHRleHQgPSAnVGhpcyBpcyBhIG5vcm1hbCBtZXNzYWdlIHdpdGhvdXQgc2Vuc2l0aXZlIGRhdGEnO1xuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS5yZWRhY3RQaWkodGV4dCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQudGV4dCkudG9CZSh0ZXh0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQucGlpRm91bmQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZWRhY3RlZEZpZWxkcykudG9FcXVhbChbXSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZWRhY3RQaWlGcm9tT2JqZWN0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVkYWN0IFBJSSBmcm9tIG9iamVjdCBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgb2JqID0ge1xuICAgICAgICBuYW1lOiAnSm9obiBEb2UnLFxuICAgICAgICBlbWFpbDogJ2pvaG5AZXhhbXBsZS5jb20nLFxuICAgICAgICBwaG9uZTogJysxMjM0NTY3ODkwJyxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBpcDogJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgICBub3RlczogJ0NvbnRhY3QgYXQgamFuZUB0ZXN0LmNvbScsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBzZXJ2aWNlLnJlZGFjdFBpaUZyb21PYmplY3Qob2JqKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5vYmoubmFtZSkudG9CZSgnSm9obiBEb2UnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQub2JqLmVtYWlsKS50b0JlKCdbRU1BSUxfUkVEQUNURURdJyk7XG4gICAgICBleHBlY3QocmVzdWx0Lm9iai5waG9uZSkudG9CZSgnW1BIT05FX1JFREFDVEVEXScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5vYmoubWV0YWRhdGEuaXApLnRvQmUoJ1tJUF9SRURBQ1RFRF0nKTtcbiAgICAgIGV4cGVjdChyZXN1bHQub2JqLm1ldGFkYXRhLm5vdGVzKS50b0JlKCdDb250YWN0IGF0IFtFTUFJTF9SRURBQ1RFRF0nKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucGlpRm91bmQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlZGFjdGVkRmllbGRzKS50b0NvbnRhaW4oJ2VtYWlsJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlZGFjdGVkRmllbGRzKS50b0NvbnRhaW4oJ3Bob25lX251bWJlcicpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZWRhY3RlZEZpZWxkcykudG9Db250YWluKCdpcF9hZGRyZXNzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBhcnJheXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhcnIgPSBbXG4gICAgICAgICdqb2huQGV4YW1wbGUuY29tJyxcbiAgICAgICAgJysxMjM0NTY3ODkwJyxcbiAgICAgICAgJ25vcm1hbCB0ZXh0JyxcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHNlcnZpY2UucmVkYWN0UGlpRnJvbU9iamVjdChhcnIpO1xuXG4gICAgICBleHBlY3QocmVzdWx0Lm9ialswXSkudG9CZSgnW0VNQUlMX1JFREFDVEVEXScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5vYmpbMV0pLnRvQmUoJ1tQSE9ORV9SRURBQ1RFRF0nKTtcbiAgICAgIGV4cGVjdChyZXN1bHQub2JqWzJdKS50b0JlKCdub3JtYWwgdGV4dCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5waWlGb3VuZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5lc3RlZCBvYmplY3RzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgb2JqID0ge1xuICAgICAgICBsZXZlbDE6IHtcbiAgICAgICAgICBsZXZlbDI6IHtcbiAgICAgICAgICAgIGxldmVsMzoge1xuICAgICAgICAgICAgICBlbWFpbDogJ2RlZXBAZXhhbXBsZS5jb20nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS5yZWRhY3RQaWlGcm9tT2JqZWN0KG9iaik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQub2JqLmxldmVsMS5sZXZlbDIubGV2ZWwzLmVtYWlsKS50b0JlKCdbRU1BSUxfUkVEQUNURURdJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnBpaUZvdW5kKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbm9uLW9iamVjdCBpbnB1dCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHNlcnZpY2UucmVkYWN0UGlpRnJvbU9iamVjdCgndGVzdEBleGFtcGxlLmNvbScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5vYmopLnRvQmUoJ1tFTUFJTF9SRURBQ1RFRF0nKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucGlpRm91bmQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBudWxsIGFuZCB1bmRlZmluZWQnLCAoKSA9PiB7XG4gICAgICBleHBlY3Qoc2VydmljZS5yZWRhY3RQaWlGcm9tT2JqZWN0KG51bGwpLm9iaikudG9CZShudWxsKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLnJlZGFjdFBpaUZyb21PYmplY3QodW5kZWZpbmVkKS5vYmopLnRvQmUodW5kZWZpbmVkKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NvbnRhaW5zUGlpJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZGV0ZWN0IFBJSSBwcmVzZW5jZScsICgpID0+IHtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmNvbnRhaW5zUGlpKCdDb250YWN0OiBqb2huQGV4YW1wbGUuY29tJykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3Qoc2VydmljZS5jb250YWluc1BpaSgnQ2FsbCArMTIzNDU2Nzg5MCcpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuY29udGFpbnNQaWkoJ05vcm1hbCB0ZXh0JykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuY29udGFpbnNQaWkoJycpKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmNvbnRhaW5zUGlpKG51bGwgYXMgYW55KSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRQaWlTdGF0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBQSUkgc3RhdGlzdGljcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRleHQgPSAnQ29udGFjdCBqb2huQGV4YW1wbGUuY29tIG9yIGphbmVAdGVzdC5jb20sIGNhbGwgKzEyMzQ1Njc4OTAgb3IgKzA5ODc2NTQzMjEnO1xuICAgICAgY29uc3Qgc3RhdHMgPSBzZXJ2aWNlLmdldFBpaVN0YXRzKHRleHQpO1xuXG4gICAgICBleHBlY3Qoc3RhdHMuZW1haWwpLnRvQmUoMik7XG4gICAgICBleHBlY3Qoc3RhdHMucGhvbmVfbnVtYmVyKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHN0YXRzLmNyZWRpdF9jYXJkKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHN0YXRzLnNzbikudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHRleHQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGF0cyA9IHNlcnZpY2UuZ2V0UGlpU3RhdHMoJycpO1xuICAgICAgZXhwZWN0KE9iamVjdC52YWx1ZXMoc3RhdHMpLmV2ZXJ5KGNvdW50ID0+IGNvdW50ID09PSAwKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3BhdHRlcm4gbWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFsbG93IGFkZGluZyBjdXN0b20gcGF0dGVybnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjdXN0b21SZWdleCA9IC9DVVNUT00tXFxkezR9L2c7XG4gICAgICBzZXJ2aWNlLmFkZFBhdHRlcm4oJ2N1c3RvbScsIGN1c3RvbVJlZ2V4LCAnW0NVU1RPTV9SRURBQ1RFRF0nKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS5yZWRhY3RQaWkoJ0NvZGU6IENVU1RPTS0xMjM0Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LnRleHQpLnRvQmUoJ0NvZGU6IFtDVVNUT01fUkVEQUNURURdJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnBpaUZvdW5kKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyByZW1vdmluZyBwYXR0ZXJucycsICgpID0+IHtcbiAgICAgIHNlcnZpY2UucmVtb3ZlUGF0dGVybignZW1haWwnKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS5yZWRhY3RQaWkoJ0NvbnRhY3Q6IGpvaG5AZXhhbXBsZS5jb20nKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudGV4dCkudG9CZSgnQ29udGFjdDogam9obkBleGFtcGxlLmNvbScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5waWlGb3VuZCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBhbGwgcGF0dGVybnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXR0ZXJucyA9IHNlcnZpY2UuZ2V0UGF0dGVybnMoKTtcbiAgICAgIGV4cGVjdChwYXR0ZXJucykudG9IYXZlUHJvcGVydHkoJ2VtYWlsJyk7XG4gICAgICBleHBlY3QocGF0dGVybnMpLnRvSGF2ZVByb3BlcnR5KCdwaG9uZScpO1xuICAgICAgZXhwZWN0KHBhdHRlcm5zKS50b0hhdmVQcm9wZXJ0eSgnY3JlZGl0Q2FyZCcpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==